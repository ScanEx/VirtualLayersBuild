{"version":3,"sources":["webpack:///webpack/bootstrap 2bbefdcb3b45cdf3ecc5","webpack:///./entry.js","webpack:///./external/GMXClusterLayer/dist/clusterLayer.js","webpack:///./external/FireVirtualLayer/dist/fireVirtualLayer.js","webpack:///./external/GMXPluginGFW/dist/gmxPluginGfw.js","webpack:///./external/GMXPluginGFW/dist/gmxPluginGfw.css"],"names":["require","RotatedMarker","L","Marker","extend","options","angle","statics","TRANSFORM_ORIGIN","DomUtil","testProp","_initIcon","prototype","call","_icon","style","_getTransformOrigin","iconAnchor","icon","_setPos","pos","TRANSFORM","Browser","ie","rad","Math","PI","costheta","cos","sintheta","sin","filter","setAngle","ang","rotatedMarker","pick","obj","keys","Object","k","indexOf","reduce","prev","curr","o","bool","v","ClusterLayer","Class","includes","Mixin","Events","dataLayer","dataLayerId","openPopupOnClick","openPopupOnHover","undefined","initialize","setOptions","_markerClusterGroup","markerClusterGroup","_updateBbox","_styleManager","gmx","currentZoom","_map","getZoom","screenBounds","getBounds","p1","getNorthWest","p2","getSouthEast","bbox","gmxUtil","bounds","lng","lat","_observer","setBounds","onAdd","map","_getDataLayer","then","_dataLayer","_gmx","styleManager","initStyles","on","_bindDataProvider","catch","err","console","error","addLayer","_onMapZoomend","_bindPopupEvents","onRemove","dl","_unbindDataProvider","removeLayer","off","setDateInterval","dateBegin","dateEnd","_dateInterval","apply","openPopup","itemId","originalEvent","layer","item","dataManager","getItem","itemGeo","properties","length","latlng","Projection","Mercator","unproject","x","coordinates","y","parsedProperties","getItemProperties","popup","createPopup","_popup","once","_popupMode","setLatLng","openOn","propertiesHash","id","propertiesArr","balloonData","getItemBalloon","DisableBalloonOnClick","getItemStyle","protoOffset","Popup","offset","sx","sy","setContent","parseBalloonTemplate","templateBalloon","tileAttributeTypes","unitOptions","geometries","le","hl","hasLayer","minZoom","maxZoom","_pGetDataLayer","Promise","resolve","reject","dataLayerRef","arRes","split","loadLayer","addObserver","type","filters","dateInterval","callback","_onObserverData","bind","removeObserver","data","markers","added","parsedStyleKeys","itemGeoJson","itemStyle","iconUrl","createIconMarker","marker","clearLayers","addLayers","fire","rotate","createIconMarkerIcon","image","getSVGIcon","_closePopup","_popupOnClustersMarkerMouseover","_popupOnClustersMarkerMouseout","_popupOnClustersAnimationEnd","ev","_popupOnClustersMarkerClick","mcg","nsGmx","window","module","exports","_polygon","assert","_vector","_EF","$p","$v","SpatialQuery","polygonsorientation","Array","fragmenttype","boundaryfragment","resultsorientation","edge_list","insertE","fragment","reg","i","splice","push","deleteE","popnextE","point","result","searchE","organizeE","attribs","dims","vector","z","init_union_tables","ORIENTATION_SAME","ORIENTATION_OPPOSITE","T_VERTEX_INSIDE","T_VERTEX_OUTSIDE","DIRECTION_NONE","DIRECTION_FORWARD","DIRECTION_BOTH","bound_minX","Number","MAX_VALUE","bound_maxX","bound_minY","bound_maxY","head","tail","direciton","holes","TYPE_ISLAND","count","polygon","p","direction","add_point","T_VERTEX_BOUNDARY","compute_direction","DIRECTION_INVALID","minXNode","foreach","node","next","DIRECTION_CLOCKWISE","DIRECTION_COUNTERCLOCKWISE","reverse_direction","start","current","tmp","union","otherPoly","boolean_operation","OPERATION_UNION","e","log","A","B","Oper","Reg","orientationA","orientationB","edgeFragments","nInside","point_inside_2d","noIntersections","a_start","a_end","node2","b_start","b_end","seg1","seg2","intersection","pointOfIntersectionForLineSegments","Point","vtx","insert_vertex_after","Type","end","seg","m","res","Type2","Out","outHoles","outPolygons","fNext","edgeLoop","cEdge","resultPolygon","startPoint","iLoopEdge","dy1","dy2","slope1","slope2","pt","add_vtx","fn","after","nxt","to_wkt","a","str","iHole","b","to_point_array_2d","wn","isBoundary","v_x","v_y","numberInRange","n","min","max","seg_a","seg_b","ua","ub","pointOfIntersectionForLineSegmentsDiag","start_a","end_a","start_b","end_b","denom","numer_a","numer_b","TYPE_HOLE","DIRECTION_OPPOSITE","OPERATION_INTERSECTION","OPERATION_DIFFERENCE","OPERATION_REV_DIFFERENCE","Translations","addText","FireVirtualLayer","ModisPixelDimensions","buildModisPixelDimensionsTable","h","EARTH_RADIUS","SAMPLES","r","s","sample","theta","cos_theta","temp","pow","sqrt_temp","sqrt","DS","DT","_hq","getDistant","cpt","bl","Vy","Vx","findMostDistantPointFromBaseLine","baseLine","points","maxD","maxPt","newPoints","idx","d","buildConvexHull","convexHullBaseLines","t","maxPoint","concat","getConvexHull","maxX","minX","minPt","ch","MultiPolygonUnion","multiPolygon","matrixMultiPolygon","unitedMultiPolygon","nStartPolygons","currentPolygon","pop","iOther","unionResults","poly","getPixelMultiPolygon","results","merc","project","X1","Y1","X2","Y2","newLatLng","newLat","newLon","mdelta","distVincenty","h_scale","v_scale","h_dx","h_dy","v_dx","v_dy","frontX","frontY","backX","backY","corner1x","corner1y","corner2x","corner2y","corner3x","corner3y","corner4x","corner4y","mercBbox","latlngBbox","mercMin","mercMax","fromMercBbox","getExtendedBbox","mercOld","newBbox","extendBbox","mercNew","oldSquare","newSquare","contains","simpleheat","canvas","_canvas","document","getElementById","_ctx","getContext","_width","width","_height","height","_max","_data","defaultRadius","defaultGradient","add","clear","radius","blur","_radius","_blur","_r","minRadius","_minRadius","_circle","circle","createElement","ctx","r2","shadowOffsetX","shadowOffsetY","shadowBlur","shadowColor","beginPath","arc","closePath","fill","gradient","grad","createLinearGradient","addColorStop","fillStyle","fillRect","_grad","getImageData","draw","minOpacity","clearRect","len","globalAlpha","rr","drawImage","colored","_colorize","putImageData","pixels","j","HeatLayer","Layer","latlngs","_latlngs","setLatLngs","redraw","addLatLng","_heat","_updateOptions","_frame","_animating","Util","requestAnimFrame","_redraw","_initCanvas","_panes","overlayPane","appendChild","_reset","zoomAnimation","any3d","_animateZoom","getPanes","removeChild","addTo","create","size","getSize","animated","addClass","topLeft","containerPointToLayerPoint","setPosition","LatLngBounds","containerPointToLatLng","getMaxZoom","cellSize","grid","panePos","_getMapPanePos","offsetX","offsetY","cell","len2","latLngToContainerPoint","floor","alt","round","scale","getZoomScale","zoom","_getCenterOffset","center","_multiplyBy","subtract","setTransform","getTranslateString","minClustersZoom","minGeomZoom","minHotspotZoom","hostName","_clustersLayer","createLayer","title","attributes","styles","Filter","Balloon","getText","MinZoom","MaxZoom","RenderStyle","radialGradient","r1","label","color","field","align","_clustersGeomLayer","outline","thickness","opacity","HoverStyle","_heatmapLayer","setZIndex","_this","event","html","getContent","zoomLink","$","click","closePopup","setView","div","append","_layerIsVisible","_lazyLoadDataLayers","_updateLayersVisibility","_hotspotLayer","_dateBegin","_dateEnd","_rawClusterLayer","_observerClusters","_observerHotspots","_observerHeatmap","observersBbox","extendedBbox","_loadLayersPromise","heatmapLayerID","hotspotLayerID","loadLayers","mapID","layerID","dailyLayerID","rawHotspotLayer","rawClustersLayer","setStyles","getStyles","rawHeatmapLayer","_createHeatmapObserverCallback","active","_updateClustersByObject","srcLayer","heatLayer","pointsBuffer","weightFieldsHash","addData","removeData","it","find","parser","props","fi","factor","w","removed","estimeteGeometry","clusterAttr","countAttr","fromLayer","indexes","tileAttributeIndexes","dateAttr","getGmxProperties","TemporalColumnName","idAttr","identityField","parseItem","getPropertiesHash","geometry","clusters","objects","clustersToRepaint","onExtent","mult","clusterId","hotspotId","spots","startDate","POSITIVE_INFINITY","endDate","NEGATIVE_INFINITY","isIndustrial","cluster","coords","hotspotDate","FireType","clustersToAdd","itemIDsToRemove","strStartDate","dateToString","strEndDate","newItem","String","tmpPolygon","timestamp","date","Date","lz","getUTCDate","getUTCMonth","getUTCFullYear","isVisible","toggleActive","FireVirtualFactory","initFromDescription","layerDescription","meta","MetaProperties","Value","z_index","addLayerClass","GFW_ATTRIBUTION","GFWLayer","TileLayer","Canvas","async","attribution","_yearBegin","_yearEnd","_drawLayer","img","imgData","exp","pixelPos","yearLoss","intensity","drawTile","tilePoint","Image","crossOrigin","onload","tileDrawn","src","setYearInterval","yearBegin","yearEnd","GFWLayerWithSlider","_layer","_slider","GFWSlider","position","addControl","removeControl","arguments","getSlider","Control","_setYears","template","Handlebars","compile","labels","year","ui","_ui","slider","values","range","change","stopPropagation","saveState","version","loadState","defineClass","GeoMixerGFWLayer","_gmxProperties","gmxCore","addModule","layerClass","init","path","loadCSS","when","loadScript","publicInterface","pluginName","loadModule"],"mappings":"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","file":"virtual-layers.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId])\n \t\t\treturn installedModules[moduleId].exports;\n\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\texports: {},\n \t\t\tid: moduleId,\n \t\t\tloaded: false\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.loaded = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(0);\n\n\n\n/** WEBPACK FOOTER **\n ** webpack/bootstrap 2bbefdcb3b45cdf3ecc5\n **/","require('./external/GMXClusterLayer')\nrequire('./external/FireVirtualLayer')\nrequire('./external/GMXPluginGFW/dist/gmxPluginGfw.js')\nrequire('./external/GMXPluginGFW/dist/gmxPluginGfw.css')\n\n\n\n/** WEBPACK FOOTER **\n ** ./entry.js\n **/",";(function() {\n\"use strict\";\n\n// https://github.com/bbecquet/Leaflet.PolylineDecorator/blob/master/src/L.RotatedMarker.js\n\nconst RotatedMarker = L.Marker.extend({\n    options: {\n        angle: 0\n    },\n\n    statics: {\n        TRANSFORM_ORIGIN: L.DomUtil.testProp(\n            ['transformOrigin', 'WebkitTransformOrigin', 'OTransformOrigin', 'MozTransformOrigin', 'msTransformOrigin'])\n    },\n\n    _initIcon: function() {\n        L.Marker.prototype._initIcon.call(this);\n\n        this._icon.style[L.RotatedMarker.TRANSFORM_ORIGIN] = this._getTransformOrigin();\n    },\n\n    _getTransformOrigin: function() {\n        var iconAnchor = this.options.icon.options.iconAnchor;\n\n        if (!iconAnchor) {\n            return '50% 50%';\n        }\n\n        return iconAnchor[0] + 'px ' + iconAnchor[1] + 'px';\n    },\n\n    _setPos: function(pos) {\n        L.Marker.prototype._setPos.call(this, pos);\n\n        if (L.DomUtil.TRANSFORM) {\n            // use the CSS transform rule if available\n            this._icon.style[L.DomUtil.TRANSFORM] += ' rotate(' + this.options.angle + 'deg)';\n        } else if (L.Browser.ie) {\n            // fallback for IE6, IE7, IE8\n            var rad = this.options.angle * (Math.PI / 180),\n                costheta = Math.cos(rad),\n                sintheta = Math.sin(rad);\n            this._icon.style.filter += ' progid:DXImageTransform.Microsoft.Matrix(sizingMethod=\\'auto expand\\', M11=' +\n                costheta + ', M12=' + (-sintheta) + ', M21=' + sintheta + ', M22=' + costheta + ')';\n        }\n    },\n\n    setAngle: function(ang) {\n        this.options.angle = ang;\n    }\n});\n\nconst rotatedMarker = function(pos, options) {\n    return new L.RotatedMarker(pos, options);\n};\n\nfunction pick(obj, keys) {\n    return Object.keys(obj).filter(function(k) {\n        return !!(keys.indexOf(k) + 1)\n    }).reduce(function(prev, curr) {\n        var o = {}\n        o[curr] = obj[curr]\n        return L.extend(prev, o)\n    }, {})\n}\n\nfunction bool(v) {\n    if (v === 'false') {\n        return false\n    }\n    return !!v\n}\n\nconst ClusterLayer = L.Class.extend({\n    includes: [L.Mixin.Events],\n\n    options: {\n        dataLayer: null,\n        dataLayerId: '',\n        openPopupOnClick: true,\n        openPopupOnHover: undefined\n    },\n\n    // options.minZoom\n    // options.maxZoom\n    // options.dataLayer\n    // options.dataLayerId\n    // options.openPopupOnClick\n    // options.openPopupOnHover\n    // + MarkerClusterGroup options\n    initialize: function(options) {\n        L.setOptions(this, options)\n        this.options.openPopupOnClick = bool(this.options.openPopupOnClick)\n        this.options.openPopupOnHover = bool(this.options.openPopupOnHover)\n        this._markerClusterGroup = L.markerClusterGroup(pick(this.options, [\n            'showCoverageOnHover',\n            'zoomToBoundsOnClick',\n            'spiderfyOnMaxZoom',\n            'removeOutsideVisibleBounds',\n            'animate',\n            'animateAddingMarkers',\n            'disableClusteringAtZoom',\n            'maxClusterRadius',\n            'polygonOptions',\n            'singleMarkerMode',\n            'spiderLegPolylineOptions',\n            'spiderfyDistanceMultiplier',\n            'iconCreateFunction',\n            'minZoom',\n            'maxZoom'\n        ]))\n    },\n\n    _updateBbox: function() {\n        this._styleManager.gmx.currentZoom = this._map.getZoom()\n        var screenBounds = this._map.getBounds(),\n            p1 = screenBounds.getNorthWest(),\n            p2 = screenBounds.getSouthEast(),\n            bbox = L.gmxUtil.bounds([\n                [p1.lng, p1.lat],\n                [p2.lng, p2.lat]\n            ])\n        this._observer && this._observer.setBounds(bbox)\n    },\n\n    onAdd: function(map) {\n        this._map = map\n\n        this._getDataLayer().then((dataLayer) => {\n            this._dataLayer = dataLayer\n            this._styleManager = this._dataLayer._gmx.styleManager\n            return this._styleManager.initStyles()\n        }).then(() => {\n            map.on('moveend', this._updateBbox, this)\n            this._updateBbox()\n            this._bindDataProvider()\n        }).catch((err) => {\n            console.error(err)\n        })\n\n        map.addLayer(this._markerClusterGroup)\n        map.on('zoomend', this._onMapZoomend, this)\n        this._onMapZoomend()\n        this._bindPopupEvents()\n    },\n\n    onRemove: function(map) {\n        this._getDataLayer().then((dl) => {\n            this._unbindDataProvider()\n            map.removeLayer(this._markerClusterGroup)\n            map.off('moveend', this._updateBbox, this)\n        })\n        map.off('zoomend', this._onMapZoomend, this)\n    },\n\n    setDateInterval: function(dateBegin, dateEnd) {\n        this._dateInterval = [dateBegin, dateEnd]\n        this._observer && this._observer.setDateInterval.apply(this._observer, this._dateInterval)\n    },\n\n    openPopup: function(itemId, originalEvent = null) {\n        const layer = this._dataLayer\n        const item = this._dataLayer._gmx.dataManager.getItem(itemId)\n\n        if (!item) { return }\n\n        const itemGeo = item.properties[item.properties.length - 1]\n        const latlng = L.Projection.Mercator.unproject({\n            x: itemGeo.coordinates[0],\n            y: itemGeo.coordinates[1]\n        })\n        const parsedProperties = layer.getItemProperties(item.properties)\n\n        const popup = this.createPopup({ parsedProperties, item, layer, originalEvent })\n\n        if (!popup) { return }\n\n        this._popup = popup\n\n        popup.once('close', () => {\n            this._popupMode = ''\n            this._popup = null\n        })\n\n        this._popup\n            .setLatLng(latlng)\n            .openOn(this._map)\n    },\n\n    createPopup: function ({ parsedProperties: propertiesHash, item: { id, properties: propertiesArr }, layer: dataLayer }) {\n        const balloonData = dataLayer._gmx.styleManager.getItemBalloon(id)\n\n        if (balloonData && !balloonData.DisableBalloonOnClick) {\n            var style = dataLayer.getItemStyle(id)\n            if (style && style.iconAnchor) {\n                var protoOffset = L.Popup.prototype.options.offset\n                this._popup.options.offset = [-protoOffset[0] - style.iconAnchor[0] + style.sx / 2,\n                    protoOffset[1] - style.iconAnchor[1] + style.sy / 2\n                ]\n            }\n\n            return L.popup()\n                .setContent(L.gmxUtil.parseBalloonTemplate(balloonData.templateBalloon, {\n                    properties: propertiesHash,\n                    tileAttributeTypes: dataLayer._gmx.tileAttributeTypes,\n                    unitOptions: this._map.options || {},\n                    geometries: [propertiesArr[propertiesArr.length - 1]]\n                }))\n        }\n    },\n\n    _onMapZoomend: function (le) {\n        const { _map, _markerClusterGroup, options } = this\n        const hl = _map.hasLayer(_markerClusterGroup)\n        if (typeof options.minZoom === 'string' && _map.getZoom() < options.minZoom / 1) {\n            hl && _map.removeLayer(_markerClusterGroup)\n        } else if (typeof options.maxZoom === 'string' && _map.getZoom() > options.maxZoom / 1) {\n            hl && _map.removeLayer(_markerClusterGroup)\n        } else {\n            !hl && _map.addLayer(_markerClusterGroup)\n        }\n    },\n\n    _getDataLayer: function () {\n        if (!this._pGetDataLayer) {\n            this._pGetDataLayer = new Promise((resolve, reject) => {\n                if (this.options.dataLayer) {\n                    return resolve(this.options.dataLayer)\n                } else if (this.options.dataLayerRef) {\n                    const arRes = this.options.dataLayerRef.split(':')\n                    if (arRes.length !== 2) {\n                        return reject('invalid dataLayerRef')\n                    }\n                    return L.gmx.loadLayer(arRes[0], arRes[1]).then(resolve, reject)\n                }\n                return reject('dataLayer is not specified')\n            })\n        }\n\n        return this._pGetDataLayer\n    },\n\n    _bindDataProvider: function() {\n        this._observer = this._dataLayer.addObserver({\n            type: 'resend',\n            filters: ['styleFilter'],\n            dateInterval: this._dateInterval,\n            callback: this._onObserverData.bind(this)\n        })\n    },\n\n    _unbindDataProvider: function() {\n        this._dataLayer.removeObserver(this._observer)\n        this._observer = null\n    },\n\n    _onObserverData: function(data) {\n        const { dataLayer } = this.options\n\n        // this._vectorTileItemsProperties = {}\n        const markers = data.added.map(({ id, properties, item: { parsedStyleKeys } }) => {\n            // this._vectorTileItemsProperties[id] = dataLayer.getItemProperties(properties)\n            const itemGeoJson = properties[properties.length - 1]\n            if (itemGeoJson.type !== 'POINT') {\n                return\n            }\n\n            const itemStyle = parsedStyleKeys || dataLayer.getItemStyle(id)\n\n            const latlng = L.Projection.Mercator.unproject({\n                x: itemGeoJson.coordinates[0],\n                y: itemGeoJson.coordinates[1]\n            })\n\n            if (itemStyle.iconUrl) {\n                return createIconMarker(latlng, itemStyle, { id })\n            } else {\n                return L.marker(latlng, { id })\n            }\n        }).filter(item => !!item)\n\n        this._markerClusterGroup.clearLayers()\n        this._markerClusterGroup.addLayers(markers)\n\n        this.fire('update')\n\n        function createIconMarker(latlng, itemStyle, options) {\n            if (itemStyle.rotate) {\n                return rotatedMarker(latlng, L.extend({}, {\n                    icon: createIconMarkerIcon(itemStyle),\n                    angle: itemStyle.rotate\n                }, options))\n            } else {\n                return L.marker(latlng, L.extend({}, {\n                    icon: createIconMarkerIcon(itemStyle)\n                }, options))\n            }\n        }\n\n        function createIconMarkerIcon(itemStyle) {\n            if (itemStyle && itemStyle.iconUrl) {\n                var iconAnchor = itemStyle.image ? [itemStyle.sx / 2, itemStyle.sy / 2] : [8, 10]\n                return L.icon({\n                    iconAnchor: iconAnchor,\n                    iconUrl: itemStyle.iconUrl\n                })\n            } else {\n                return L.gmxUtil.getSVGIcon(itemStyle)\n            }\n        }\n\n    },\n\n    _closePopup: function() {\n        if (!this._popup) {\n            return\n        }\n\n        this._map.removeLayer(this._popup)\n        this._popup = null\n    },\n\n    _popupOnClustersMarkerMouseover: function ({ layer: marker, latlng, originalEvent }) {\n        if (!this.options.openPopupOnHover) {\n            return\n        }\n\n        if (!this._popupMode) {\n            this._popupMode = 'hover'\n            this.openPopup(marker.options.id, originalEvent)\n        }\n    },\n\n    _popupOnClustersMarkerMouseout: function (le) {\n        if (this._popupMode === 'hover') {\n            this._closePopup()\n            this._popupMode = ''\n        }\n    },\n\n    _popupOnClustersAnimationEnd: function (ev) {\n        // const map = this._popup && this._popup._map\n        // map && map.removeLayer(this._popup)\n    },\n\n    _popupOnClustersMarkerClick: function ({ layer: marker, latlng, originalEvent }) {\n        if (!this.options.openPopupOnClick) {\n            return\n        }\n\n        this._popupMode = 'click'\n        this.openPopup(marker.options.id, originalEvent)\n    },\n\n    _bindPopupEvents: function () {\n        const mcg = this._markerClusterGroup\n        mcg.on('animationend', this._popupOnClustersAnimationEnd, this)\n        mcg.on('mouseover', this._popupOnClustersMarkerMouseover, this)\n        mcg.on('mouseout', this._popupOnClustersMarkerMouseout, this)\n        mcg.on('click', this._popupOnClustersMarkerClick, this)\n    }\n})\n\nconst nsGmx = window.nsGmx || {}\n\nif (typeof module !== 'undefined' && module.exports) {\n    module.exports = ClusterLayer\n} else {\n    nsGmx.ClusterLayer = ClusterLayer\n}\n}());\n\n\n\n/** WEBPACK FOOTER **\n ** ./external/GMXClusterLayer/dist/clusterLayer.js\n **/","(function() {\n(function(){\n\n/*\n Spatial Query - a JQuery like Javascript library for handling spatial maths\n Copyright (c) 2009 Chris Zelenak\n Spatial Query is freely distributable under the MIT X11 License - see LICENSE file.\n\n Chris Z\n For work at www.indy.com\n Talked about at www.yeti-factory.org\n\n*/\nvar _polygon = function(o) {\n  return new _polygon.prototype.assert(o);\n}\nvar _vector = function(o) {\n  return new _vector.prototype.assert(o);\n}\nvar _EF = function(o) {\n  return new _EF.prototype.assert(o);\n}\n\nvar $p = _polygon;\nvar $v = _vector;\n\nwindow.SpatialQuery = {\n    $p: $p, \n    $v: $v\n}\n\n\n// Lookup tables for boolean operations (intersection, union, difference)\nvar polygonsorientation = Array();\nvar fragmenttype = Array();\nvar boundaryfragment = Array();\nvar resultsorientation = Array();\n\n\n\n_EF.prototype = {\n  assert : function() {\n    this.edge_list = [];\n\treturn this;\n  },\n  insertE : function(fragment, reg) {\n    // Check if the edge is already in the list\n\tfor(var i = 0;i < this.edge_list.length;i++) {\n\t  if((this.edge_list[i][0][0] == fragment[0][0] && this.edge_list[i][0][1] == fragment[0][1] && this.edge_list[i][1][0] == fragment[1][0] && this.edge_list[i][1][1] == fragment[1][1])){\n\t    // If the edge is already in the list, we are done.\n\t\treturn;\n\t  \n\t  }\n\t  \n\t  if(this.edge_list[i][0][0] == fragment[1][0] && this.edge_list[i][0][1] == fragment[1][1] && this.edge_list[i][1][0] == fragment[0][0] && this.edge_list[i][1][1] == fragment[0][1]) {\n\t\t// If the edge is found in the list, but reversed, remove it from the list and we are done.\n\t\tthis.edge_list.splice(i,1);\n\t\treturn;\t\t \n\t  }\n    }\n    this.edge_list.push(fragment);\n  },\n  deleteE : function(fragment) {\n    // Check if the edge is already in the list\n\tfor(var i = 0;i < this.edge_list.length;i++) {\n\t  if((this.edge_list[i][0][0] == fragment[0][0] && this.edge_list[i][0][1] == fragment[0][1] && this.edge_list[i][1][0] == fragment[1][0] && this.edge_list[i][1][1] == fragment[1][1])){\n\t    // If the edge is already in the list, delete it\n\t\tthis.edge_list.splice(i,1);\n\t\treturn;\n\t  }\n    }\n\t// Otherwise there is nothing to remove.\n\t//console.log(\"deleteE: no edge to delete.\");\n\treturn;\n  },\n  popnextE : function(point) {\n\t// Check if the edge is already in the list\n\tfor(var i = 0;i < this.edge_list.length;i++) {\n\t\tif(this.edge_list[i][0][0] == point[0] && this.edge_list[i][0][1] == point[1]){\n\t\t\tvar result =  this.edge_list[i];\n\t\t\tthis.edge_list.splice(i,1);\t\t\t\n\t\t\treturn result;\t\t  \n\t\t}\n\t}\n\treturn null;\n  },\n  searchE : function(fragment) {\n    // Check if the edge is already in the list\n\tfor(var i = 0;i < this.edge_list.length;i++) {\n\t  if((this.edge_list[i][0][0] == fragment[0][0] && this.edge_list[i][0][1] == fragment[0][1] && this.edge_list[i][1][0] == fragment[1][0] && this.edge_list[i][1][1] == fragment[1][1])){\n\t    // If the edge in the list, return it's index.\n\t\treturn i;\n\t  }\n    }\n\t\n\t//console.log(\"searchE: no edge found.\");\n\treturn -1;\n  },\n  organizeE : function() {\n    return;\n  }\n}\n\n_vector.prototype = {\n  assert: function(obj,attribs) {\n    this.data = [0, 0, 0];\n\tif(obj == undefined || obj == null){\n\t  this.dims = 0;\n\t  this.data = [];\n\t}else if(obj.vector && typeof(obj.vector) == \"function\") {\n\t  var v = obj.vector();\n\t  this.data = v.data;\n\t  this.dims = v.dims;\n\t}else if(obj.x || obj.y || obj.z){\n\t  this.data[0] = obj.x || 0.0;\n\t  this.data[1] = obj.y || 0.0;\n\t  this.data[2] = obj.z || 0.0;\n\t} else if(obj.length) {\n\t  this.data = obj;\n\t  this.dims = obj.length;\n\t}\n\t\n\tif(attribs != null && attribs != undefined){\n\t  for(var k in attribs) {\n\t    this[k] = attribs[k];\n\t  }\n\t}\n\treturn this;\t\n  },\n  \n  x : function(){\n    return this.data[0];\n  },\n  y : function(){\n    return this.data[1];\n  },\n  z : function(){\n    return this.data[2];\n  },\n  vector : function() {\n    return this;\n  }\n}\n\nfunction init_union_tables() \n{\n\tif(polygonsorientation.length > 0){\n\t\treturn;\n\t}\n\tpolygonsorientation = [[[ORIENTATION_SAME,ORIENTATION_SAME,ORIENTATION_OPPOSITE,ORIENTATION_OPPOSITE],\n\t\t\t\t\t\t\t[ORIENTATION_OPPOSITE,ORIENTATION_OPPOSITE,ORIENTATION_SAME,ORIENTATION_SAME]],\n\t\t\t\t\t\t   [[ORIENTATION_OPPOSITE,ORIENTATION_OPPOSITE,ORIENTATION_SAME,ORIENTATION_SAME],\n\t\t\t\t\t\t    [ORIENTATION_SAME,ORIENTATION_SAME,ORIENTATION_OPPOSITE,ORIENTATION_OPPOSITE]]\n\t\t\t\t\t\t  ];\n\n\tfragmenttype = [\n\t\t\t\t\t[\n\t\t\t\t\t [[T_VERTEX_INSIDE,T_VERTEX_INSIDE],[T_VERTEX_OUTSIDE,T_VERTEX_OUTSIDE],[T_VERTEX_OUTSIDE,T_VERTEX_INSIDE],[T_VERTEX_INSIDE,T_VERTEX_OUTSIDE]],\n\t\t\t\t\t [[T_VERTEX_OUTSIDE,T_VERTEX_INSIDE],[T_VERTEX_INSIDE,T_VERTEX_OUTSIDE],[T_VERTEX_INSIDE,T_VERTEX_INSIDE],[T_VERTEX_OUTSIDE,T_VERTEX_OUTSIDE]]\n\t\t\t\t\t],\n\t\t\t\t\t[\n\t\t\t\t\t [[T_VERTEX_INSIDE,T_VERTEX_OUTSIDE],[T_VERTEX_OUTSIDE,T_VERTEX_INSIDE],[T_VERTEX_OUTSIDE,T_VERTEX_OUTSIDE],[T_VERTEX_INSIDE,T_VERTEX_INSIDE]],\n\t\t\t\t\t [[T_VERTEX_OUTSIDE,T_VERTEX_OUTSIDE],[T_VERTEX_INSIDE,T_VERTEX_INSIDE],[T_VERTEX_INSIDE,T_VERTEX_OUTSIDE],[T_VERTEX_OUTSIDE,T_VERTEX_INSIDE]]\n\t\t\t\t\t]\n\t\t\t\t\t];\n\t\n\tboundaryfragment = [\n\t                    [\n\t\t\t\t\t\t  [[[DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_NONE],\t\t\t\t[DIRECTION_BOTH,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_NONE]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_FORWARD],\t\t\t\t[DIRECTION_BOTH,DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],      \t\t\t\t[DIRECTION_BOTH,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE]],\n\t\t\t\t\t\t  [[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD],\t\t[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],\t\t\t\t\t[DIRECTION_BOTH,DIRECTION_BOTH,DIRECTION_NONE,DIRECTION_NONE]]],\n\t\t\t\t\t\t\n\t\t\t\t\t\t [[[DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_FORWARD],\t\t\t\t[DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_BOTH,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_FORWARD],\t\t\t\t[DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_BOTH,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],      \t\t\t\t[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_BOTH,DIRECTION_NONE]],\n\t\t\t\t\t\t  [[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD],\t\t[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_BOTH,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],\t\t\t\t\t[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_BOTH,DIRECTION_BOTH]]]\n\t\t\t\t\t\t],\n\t\t\t\t\t\t[\n\t\t\t\t\t\t [[[DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_NONE],\t\t\t\t[DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_BOTH]],\n\t\t\t\t\t\t  [[DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_NONE],\t\t\t\t[DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_BOTH]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],      \t\t\t\t[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_BOTH]],\n\t\t\t\t\t\t  [[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD],\t\t[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],\t\t\t\t\t[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_BOTH,DIRECTION_BOTH]]],\n\t\t\t\t\t\t\n\t\t\t\t\t\t [[[DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_FORWARD],\t\t\t\t[DIRECTION_FORWARD,DIRECTION_BOTH,DIRECTION_NONE,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_FORWARD,DIRECTION_NONE,DIRECTION_FORWARD,DIRECTION_NONE],\t\t\t\t[DIRECTION_FORWARD,DIRECTION_BOTH,DIRECTION_FORWARD,DIRECTION_NONE]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],      \t\t\t\t[DIRECTION_NONE,DIRECTION_BOTH,DIRECTION_NONE,DIRECTION_NONE]],\n\t\t\t\t\t\t  [[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD],\t\t[DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD,DIRECTION_FORWARD]],\n\t\t\t\t\t\t  [[DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE,DIRECTION_NONE],\t\t\t\t\t[DIRECTION_BOTH,DIRECTION_BOTH,DIRECTION_NONE,DIRECTION_NONE]]]\n\t\t\t\t\t\t]\n\t\t\t\t\t  ];\n\t\n\tresultsorientation = [[[1,1,1,-1],\n\t                       [1,-1,1,1]],\n\t\t\t\t\t\t  [[-1,1,1,1],\n\t\t\t\t\t\t   [1,1,-1,1]]\n\t\t\t\t\t\t ];\n}\n\n_polygon.prototype = {  \n  assert: function(obj,type) {\n    init_union_tables();\n\tthis.bound_minX = Number.MAX_VALUE;\n\tthis.bound_maxX = -Number.MAX_VALUE;\n\tthis.bound_minY = Number.MAX_VALUE;\n\tthis.bound_maxY = -Number.MAX_VALUE;\n\t\n    if(obj == undefined || obj == null){\n\t   this.head = null;\n\t   this.tail = null;\n\t   this.direciton = null;\n\t   this.holes = [];\n\t   if(type == null || type == undefined) {\n\t\tthis.type = _polygon.TYPE_ISLAND;\n\t   }else{\n\t    this.type = type;\n\t   }\n\t   this.count = 0;\n\t} else if (obj.polygon && typeof(obj.polygon) == \"function\") {\n\t  var p = obj.polygon();\n\t  this.head = p.head;\n\t  this.tail = p.tail;\n\t  this.direction = p.direction;\n\t  this.count = p.count;\n\t  this.type = p.type;\n\t  this.holes = p.holes;\n\t} else if(obj.length) {\n\t  this.count = 0;\n\t  this.holes = [];\n\t  for(var i = 0;i < obj.length; i++) {\n\t    this.add_point(obj[i],{type: T_VERTEX_BOUNDARY});\n\t  }\n\t  this.direction = this.compute_direction();\n\t  if(type == null || type == undefined) {\n\t\tthis.type = _polygon.TYPE_ISLAND;\n\t   }else{\n\t    this.type = type;\n\t   }\n\t}\n\treturn this;\n  },\n  compute_direction : function(){\n    if(this.count < 3) {\n\t  return _polygon.DIRECTION_INVALID;\n\t}\n\tvar minXNode = this.head;\n\tthis.foreach(function(node) {\n\t  if ( node.x < minXNode.x) {\n\t    minXNode = node;\n\t  }\n\t});\n\tif (minXNode.next.y > minXNode.prev.y) {\n\t  return _polygon.DIRECTION_CLOCKWISE;\n\t} else {\n\t  return _polygon.DIRECTION_COUNTERCLOCKWISE;\n\t}\n  },\n  reverse_direction : function(){\n    var start = this.head;\n\tvar current = this.head;\n\tvar tmp = null;\n\t\n\tdo{\n\t\ttmp = current.next;\n\t\tcurrent.next = current.prev;\n\t\tcurrent.prev = tmp;\n\t\t// \n\t\tcurrent = current.prev; \n\t}while(current != start);\n\t\n\tthis.direction = this.compute_direction();\n  },\n  union: function(otherPoly) {  \n\ttry{\n\t\treturn _polygon.prototype.boolean_operation(this, otherPoly, OPERATION_UNION,0);\n\t}catch(e){\n\t\tconsole.log(e);\n\t}\n  },\n  boolean_operation: function(A,B,Oper,Reg) {\n\tvar orientationA = A.direction;\n\tvar orientationB = B.direction;\n\t\n\t// If the operation is union, and bounding boxes dont overlap return right away.\n\tif(A.bound_maxX < B.bound_minX || A.bound_minX > B.bound_maxX || \n\t   A.bound_maxY < B.bound_minY || A.bound_minY > B.bound_maxY) {\n\t\treturn null;\n\t}\n\t\n\t// Initialize Edge fragment structure.\n\t\n\tedgeFragments = _EF();\n\t//(function(){\n\t// Change polygon orientation according to operation table.\n\tif(polygonsorientation[A.type][B.type][Oper] == ORIENTATION_SAME && orientationA != orientationB){\n\t\tif(orientationA != orientationB){\n\t\t\tB.reverse_direction();\n\t\t}\n\t}else if(polygonsorientation[A.type][B.type][Oper] == ORIENTATION_OPPOSITE && orientationA == orientationB){\n\t\tB.reverse_direction();\n\t}\n\t\n\tvar nInside = 0;\n\t\n\t// Classify which vertices are inside the other polygon.\n\tvar node = A.head;\n\tdo { \n\t\tnode.type = B.point_inside_2d(node);\n\t\tif(node.type != T_VERTEX_OUTSIDE) {\n\t\t\tnInside++;\n\t\t}\n\t\tnode = node.next;\n\t} while(node != A.head);\n\n\tvar node = B.head;\n\tdo {\n\t\tnode.type = A.point_inside_2d(node);\n\t\tif(node.type != T_VERTEX_OUTSIDE) {\n\t\t\tnInside++;\n\t\t}\n\t\tnode = node.next;\n\t} while(node != B.head);\n\t\n\t// If there are no inside or boundary nodes, there is nothing to do, two polygons dont overlap.\n\tif(nInside == 0 && Oper == OPERATION_UNION) {\n\t\treturn null;\n\t}\n\t\n\t// Find intersections\n\tvar noIntersections = 1;\n\tvar node = A.head;\n\tdo {\n\t\tvar a_start = node;\n\t\tvar a_end = node.next;\t\t\n\t\t\n\t\tvar node2 = B.head;\n\t\tdo {\n\t\t\tvar b_start = node2;\n\t\t\tvar b_end = node2.next;\n\t\t\t\n\t\t\tvar seg1 = [[a_start.x,a_start.y],[a_end.x,a_end.y]];\n\t\t\tvar seg2 = [[b_start.x,b_start.y],[b_end.x,b_end.y]];\n\t\t\tvar intersection = pointOfIntersectionForLineSegments(seg1,seg2);\n\t\t\t\n\t\t\tif(intersection != null) {\n\t\t\t  // Only insert intersection if its not already a vertex.\n\t\t\t  // Otherwise just change the vertex type.\n\t\t\t  if(intersection[2] == 0){\n\t\t\t\ta_start.type = T_VERTEX_BOUNDARY;\n\t\t\t  }else if(intersection[2] == 1){\n\t\t\t\ta_end.type = T_VERTEX_BOUNDARY;\n\t\t\t  }else{\n\t\t\t\tvar Point = new _polygon.prototype.vtx(intersection,{type: T_VERTEX_BOUNDARY});\n\t\t\t\tA.insert_vertex_after(Point,a_start);\n\t\t\t\ta_end = node.next;\t\t\t\t\n\t\t\t  }\n\t\t\t  \n\t\t\t  if(intersection[3] == 0){\n\t\t\t\tb_start.type = T_VERTEX_BOUNDARY;\n\t\t\t  }else if(intersection[3] == 1){\n\t\t\t\tb_end.type = T_VERTEX_BOUNDARY;\n\t\t\t  }else{\n\t\t\t\tvar Point = new _polygon.prototype.vtx(intersection,{type: T_VERTEX_BOUNDARY});\n\t\t\t\tB.insert_vertex_after(Point,b_start);\n\t\t\t\tb_end = node2.next;\n\t\t\t  }\n\t\t\t}\n\t\t\tnode2 = node2.next;\n\t\t} while(node2 != B.head)\n\t\t\n\t\tnode = node.next;\n\t} while(node != A.head);\n\t//})();\n\t\n\t//(function(){\n\t// Classify, select and organize edge fragments\n\tvar Type = fragmenttype[A.type][B.type][Oper][0];\t\n\t\n\tvar node = A.head;\n\tdo { \n\t\tvar start = node;\n\t\tvar end = node.next;\t\t\n\t\tvar seg = [[start.x,start.y],[end.x,end.y]];\n\t\t\n\t\tif(start.type == Type || end.type == Type) {\t\t\t\n\t\t\tedgeFragments.insertE(seg);\n\t\t} else if (start.type == T_VERTEX_BOUNDARY && end.type == T_VERTEX_BOUNDARY) {\n\t\t\tvar m = [ (end.x + start.x)/2, (end.y + start.y)/2 ];\n\t\t\tvar res = B.point_inside_2d(m);\n\t\t\t\n\t\t\tif(res == Type || res == T_VERTEX_BOUNDARY){\n\t\t\t\tedgeFragments.insertE(seg);\n\t\t\t}\n\t\t}\n\t\tnode = node.next;\n\t} while(node != A.head);\n\t\n\tvar Type2 = fragmenttype[A.type][B.type][Oper][1];\n\t\n\tvar node = B.head;\n\tdo { \n\t\tvar start = node;\n\t\tvar end = node.next;\t\t\n\t\tvar seg = [[start.x,start.y],[end.x,end.y]];\n\t\t\n\t\tif(start.type == Type2 || end.type == Type2) {\t\t\t\n\t\t\tedgeFragments.insertE(seg);\n\t\t} else if (start.type == T_VERTEX_BOUNDARY && end.type == T_VERTEX_BOUNDARY) {\n\t\t\tvar m = [ (end.x + start.x)/2, (end.y + start.y)/2 ];\n\t\t\tvar res = A.point_inside_2d(m);\n\t\t\t\n\t\t\tif(res == Type2 || res == T_VERTEX_BOUNDARY){\n\t\t\t\tedgeFragments.insertE(seg);\n\t\t\t}\n\t\t}\n\t\tnode = node.next;\n\t} while(node != B.head);\n\t\n\t/*\n\tfor(iEdge = 0;iEdge < edgeFragments.edge_list.length;iEdge++) {\n\t\tseg = edgeFragments.edge_list[iEdge];\n\t\trevEdge = [seg[1],seg[0]];\n\t\tvar iRevEdge = edgeFragments.searchE(revEdge);\n\t\t\n\t\t// TODO: Compute situation code\n\t\tvar sit = 0;\n\t\t\n\t\td = boundaryfragment[A.type][B.type][sit][Reg][Oper];\n\t\t\n\t\tif(d == DIRECTION_NONE) {\n\t\t\tedgeFragments.deleteE(seg);\n\t\t\tif(iRevEdge >= 0) {\n\t\t\t\tedgeFragments.deleteE(revEdge);\n\t\t\t}\n\t\t\t// TODO Verify this code is correct\n\t\t} else if(d == DIRECTION_BOTH){\n\t\t\tedgeFragments.delteE(seg);\t\n\t\t\t// TOdo investigate what to do here exactly, not quiet clear\n\t\t}\n\t}\n\t*/\n\t\n\tedgeFragments.organizeE();\n\t//})();\n\tvar Out = null;\n\tvar outHoles = [];\n\tvar outPolygons = [];\n\t\n\t\n\t//(function constructResultPolygons(){\n\t// Construct the result polygons and find their types.\n\twhile(edgeFragments.edge_list.length > 0) {\n\t\tvar fNext = edgeFragments.popnextE(edgeFragments.edge_list[0][0]);\n\t\t\n\t\tvar edgeLoop = [];\n\t\t\n\t\tdo {\n\t\t\tedgeLoop.push(fNext);\n\t\t\tfNext = edgeFragments.popnextE(fNext[1]);\n\t\t}while(fNext != null);\n\t\t\t\t\t\n\t\tvar cEdge = edgeLoop[0];\t\t\n\t\t\n\t\tvar resultPolygon = $p();\n\t\tvar startPoint = cEdge[0];\n\t\t\n\t\tfor(var iLoopEdge = 1;iLoopEdge <= edgeLoop.length;iLoopEdge++) {\n\t\t\tvar seg1 = cEdge;\n\t\t\t\n\t\t\tif(iLoopEdge == edgeLoop.length) {\t\t\t\n\t\t\t\t// Add the first point of the edge loop into the result polygon.\n\t\t\t\tseg2 = [startPoint,[resultPolygon.head.x,resultPolygon.head.y]];\n\t\t\t} else {\n\t\t\t\tseg2 = edgeLoop[iLoopEdge];\n\t\t\t}\n\t\t\t\n\t\t\tvar dy1 = (seg1[1][1] - seg1[0][1]);\n\t\t\tvar dy2 = (seg2[1][1] - seg2[0][1]);\n\t\t\t\n\t\t\tvar slope1 = Number.MAX_VALUE; // Default to Number.MAX_VALUE, when dividing by 0\t\n\t\t\tvar slope2 = Number.MAX_VALUE;\n\t\t\t\n\t\t\tif(dy1 != 0){\n\t\t\t\tslope1 = (seg1[1][0] - seg1[0][0]) / dy1;\n\t\t\t}\n\t\t\tif(dy2 != 0){\n\t\t\t\tslope2 = (seg2[1][0] - seg2[0][0]) / dy2;\n\t\t\t}\n\t\t\t\n\t\t\t// Check if the two edges are colinear, if they are join them\n\t\t\tif(slope1 == slope2){\n\t\t\t\tcEdge = [seg1[0],seg2[1]];\n\t\t\t}else{\n\t\t\t\t// Otherwise record the edge in to the output structure\n\t\t\t\tresultPolygon.add_point(cEdge[1]);\n\t\t\t\tcEdge = seg2;\n\t\t\t}\n\t\t}\n\t\t\n\t\t// Figure out the orientation of the current result polygon\n\t\tresultPolygon.direction = resultPolygon.compute_direction();\n\t\tif(resultPolygon.direction == orientationA) {\n\t\t\tif(resultsorientation [A.type][B.type][Oper] == ORIENTATION_SAME){\n\t\t\t\tresultPolygon.type = (Number)(A.type);\n\t\t\t} else {\n\t\t\t\tresultPolygon.type = (Number)(!A.type);\n\t\t\t}\n\t\t} else if(resultsorientation [A.type][B.type][Oper] == ORIENTATION_SAME) {\n\t\t\tresultPolygon.type = (Number)(!A.type);\n\t\t} else {\n\t\t\tresultPolygon.type = (Number)(A.type);\n\t\t}\n\t\t\n\t\tif(resultPolygon.type == _polygon.TYPE_ISLAND) {\n\t\t\toutPolygons.push(resultPolygon);\n\t\t} else {\n\t\t\toutHoles.push(resultPolygon);\n\t\t}\n\t}\n\t//})();\n\t\n\tif(outPolygons.length == 1){\n\t\tOut = outPolygons[0];\n\t\tOut.holes = outHoles;\n\t}else{\n\t\tconsole.log('Output polygons invalid. Length = '+outPolygons.length);\n\t}\n\t\n\treturn Out;\t\n  },\n  vtx : function(pt, attribs) {\n    this.x = (pt[0]) || 0.0;\n\tthis.y = (pt[1]) || 0.0;\n\tthis.next = null;\n\tthis.prev = null;\n\t\n\tif(attribs != null && attribs != undefined){\n\t  for(var k in attribs) {\n\t    this[k] = attribs[k];\n\t  }\n\t}\n\treturn this;  \n  },\n  add_point : function(point, attribs) {\n    var v = new _polygon.prototype.vtx(point, attribs);\n\tthis.add_vtx(v);\n\treturn this;\n  },\n  foreach : function(fn){\n    var node = this.head;\n\tdo { \n\t  fn.apply(this, [node]);\n\t  node = node.next;\n\t} while(node != this.head);\n  },\n  add_vtx : function(vtx) {\n\t// Update polygon bounding box.\n\tif(vtx.x < this.bound_minX){\n\t\tthis.bound_minX = vtx.x;\n\t}\n\tif(vtx.x > this.bound_maxX){\n\t\tthis.bound_maxX = vtx.x;\n\t}\n\tif(vtx.y < this.bound_minY){\n\t\tthis.bound_minY = vtx.y;\n\t}\n\tif(vtx.y > this.bound_maxY){\n\t\tthis.bound_maxY = vtx.y;\n\t}\n\t\n    if(this.head == null) {\n\t  this.head = vtx;\n\t  this.tail = vtx;\n\t  this.head.prev = this.head;\n\t  this.head.next = this.head;\n\t  this.count++;\n\t} else {\n\t  this.insert_vertex_after(vtx, this.tail);\n\t}\n\treturn this;  \n  },\n  insert_vertex_after : function(vtx, after) {\n    var nxt = after.next;\n\tafter.next = vtx;\n\tnxt.prev = vtx;\n\tvtx.prev = after;\n\tvtx.next = nxt;\n\tif(this.tail == after) {\n\t  this.tail = vtx;\n\t}\n\tthis.count++;\n\treturn this;\n  }, \n   to_wkt : function(){\n\t\n    var a = [];\n    this.foreach(function(node){\n                   a.push([node.x, node.y]);\n                 });\n\t\t\t\t \n\tvar str = \"POLYGON(\";\n\t\n\tstr += \"(\";\n\tfor(var i = 0; i < a.length;i++) {\n\t\tstr += a[i][0] + \" \" + a[i][1] + \",\";\n\t}\n\tstr += a[0][0] + \" \" + a[0][1];\n\tstr += \")\";\n\t\n\tfor(var iHole = 0;iHole < this.holes.length;iHole++) {\n\t\tvar b = [];\n\t\tthis.holes[iHole].foreach(function(node){\n\t\t\t   b.push([node.x, node.y]);\n\t\t\t });\n\t\tstr += \",(\";\n\t\tfor(var i = 0; i < b.length;i++) {\n\t\t\tstr += b[i][0] + \" \" + b[i][1] + \",\";\n\t\t}\n\t\tstr += b[0][0] + \" \" + b[0][1];\n\t\tstr += \")\";\t\n\t}\n\t\n\tstr +=\")\";\n\t\n    return str;\n  },\n  to_point_array_2d : function(){\n    var a = [];\n    this.foreach(function(node){\n                   a.push([node.x, node.y]);\n                 });\n    return a;\n  }, \n  point_inside_2d : function(vtx) {\n    var wn = 0;    // the winding number counter\n\t\n\tvar isBoundary = 0;\n\t\n\tvar v_x = 0;\n\tvar v_y = 0;\n\t\n\tif(vtx.x){\n\t  v_x = vtx.x;\n\t  v_y = vtx.y;\n\t} else{\n\t  v_x = vtx[0];\n\t  v_y = vtx[1];\n\t}\n\t\n\tvar seg = [[v_x, v_y],[10000000,v_y]];\n\t\n    // loop through all edges of the polygon\n\tvar node = this.head;\n\tdo {\n\t    var nxt = node.next;\n\t\tvar seg2 = [[node.x,node.y],[nxt.x,nxt.y]];\n\t\t\n\t\tvar intersection = pointOfIntersectionForLineSegments(seg,seg2);\n\t\t\n\t\tif(intersection != null) {\n\t\t\tif(intersection[2] == 0) {\n\t\t\tisBoundary = 1;\n\t\t  }\n\t\t\t// E[i] crosses upward ala Rule #1\n\t\t\tif(seg2[0][1] < seg2[1][1]) {\n\t\t\t  // For upwards edge ignore ending point\n\t\t\t  if(intersection[3] != 1){\n\t\t\t\twn++;\t\t\t  \n\t\t\t  }\n\t\t\t}else if(seg2[0][1] > seg2[1][1]) {\n\t\t\t\t// For downward edge ignore starting point\n\t\t\t\tif(intersection[3] != 0){\n\t\t\t\twn--;\n\t\t\t}\n\t\t  }\n\t\t}else if(seg2[0][1] == v_y && seg2[0][1] == seg2[1][1] && (seg2[0][0] <= v_x || seg2[1][0] <= v_x)){\n\t\t\t// Check if the point is on the boundary (between two x coordinates of the edge segment)\n\t\t\tif( (v_x >= seg2[0][0] && v_x <= seg2[1][0]) || (v_x >= seg2[1][0] && v_x <= seg2[0][0])){\n\t\t\t\tisBoundary = 1;\n\t\t\t}\n\t\t}\n\t\t\n\t\tnode = nxt;\n\t} while(node != this.head);\n\t\n\t// Handle case if the point is on the boundary of the polygon\n\tif(isBoundary) { \n\t\treturn T_VERTEX_BOUNDARY;\n\t}else{\n\t\t// Flip output for \"hole\" polygons.\n\t\tif((wn == 0 && this.type == 0) || (wn != 0 && this.type == 1)) {\n\t\t\treturn T_VERTEX_OUTSIDE;\n\t\t}else{\n\t\t\treturn T_VERTEX_INSIDE;\n\t\t}\n\t}\n  }\n}\n\n_vector.numberInRange = function(n, min, max){\n  return (n >= min && n <= max);\n};\n/*\n_vector.pointAndTypeOfIntersectionForLineSegments = function{\n\tvar intersection = pointOfIntersectionForLineSegments(seg_a, seg_b);\n\t\n\tif(intersection == null){\n\t\treturn T_VERTEX_OUTSIDE;\n\t} else {\n\t\tvar point = [intersection[0],intersection[1]];\n\t\t\n\t\tif(intersection[3] == 0 || intersection[3] == 1 || intersection[3] == 0 || intersection[3] == 1) {\n\t\t\treturn T_VERTEX_INSIDE;\n\t\t} else {\n\t\t\treturn T_VERTEX_BOUNDARY;\n\t\t}\n\t}\n}\n*/\n// segment: [ [x,y], [x2, y2] ]\n// algo and original code from:\n// http://local.wasp.uwa.edu.au/~pbourke/geometry/lineline2d/\nfunction pointOfIntersectionForLineSegments(seg_a, seg_b)\n{\t  \n  // Assume lines are horizontal or vertical;\n  \n  // If segment a is vertical\n  if(seg_a[0][0] == seg_a[1][0]) {\n  \n\t// If both vertical, return null\n\tif(seg_b[0][0] == seg_b[1][0]) {\n\t\treturn null;\n\t} else {\n\t\t// Make sure the segments intersect.\n\t\tif((seg_b[0][1] > seg_a[0][1] && seg_b[0][1] > seg_a[1][1]) || (seg_b[0][1] < seg_a[0][1] && seg_b[0][1] < seg_a[1][1]) ||\n\t\t   (seg_a[0][0] > seg_b[0][0] && seg_a[0][0] > seg_b[1][0]) || (seg_a[0][0] < seg_b[0][0] && seg_a[0][0] < seg_b[1][0])){\t\n\t\t\treturn null;\n\t\t}else{\t\t\t\n\t\t\t// Ua should be 0 if first point is on the line, 1 if last point is on the line, and 0.5 otherwise\n\t\t\tua = (seg_a[0][1] == seg_b[0][1])? 0 : ((seg_a[1][1] == seg_b[0][1])? 1 : 0.5);\n\t\t\tub = (seg_b[0][0] == seg_a[0][0])? 0 : ((seg_b[1][0] == seg_a[0][0])? 1 : 0.5);\n\t\t\t\n\t\t\treturn [\n\t\t\t  seg_a[0][0],\n\t\t\t  seg_b[0][1],\n\t\t\t  ua,\n\t\t\t  ub\n\t\t\t];\n\t\t}\n\t}\n  } else {\n\t// If both horizontal, return null\n\tif(seg_b[0][1] == seg_b[1][1]) {\n\t\treturn null;\n\t} else {\n\t\t// Make sure the segments intersect.\n\t\tif((seg_b[0][0] > seg_a[0][0] && seg_b[0][0] > seg_a[1][0]) || (seg_b[0][0] < seg_a[0][0] && seg_b[0][0] < seg_a[1][0]) ||\n\t\t   (seg_a[0][1] > seg_b[0][1] && seg_a[0][1] > seg_b[1][1]) || (seg_a[0][1] < seg_b[0][1] && seg_a[0][1] < seg_b[1][1])){\n\t\t\treturn null;\n\t\t} else {\t\t\n\t\t\t// Ua should be 0 if first point is on the line, 1 if last point is on the line, and 0.5 otherwise\n\t\t\tua = (seg_a[0][0] == seg_b[0][0])? 0 : ((seg_a[1][0] == seg_b[0][0])? 1 : 0.5);\n\t\t\tub = (seg_b[0][1] == seg_a[0][1])? 0 : ((seg_b[1][1] == seg_a[0][1])? 1 : 0.5);\n\t\t\t\n\t\t\treturn [\n\t\t\t  seg_b[0][0],\n\t\t\t  seg_a[0][1],\n\t\t\t  ua,\n\t\t\t  ub\n\t\t\t];\n\t\t}\n\t}\n  }\n  return result;\n};\n_vector.pointOfIntersectionForLineSegmentsDiag = function(seg_a, seg_b){\n  var start_a = seg_a[0],  // v1\n      end_a = seg_a[1],  // v2\n      start_b = seg_b[0], // v3\n      end_b = seg_b[1]; // v4\n\t  \n  var denom = (end_b[1] - start_b[1]) * (end_a[0] - start_a[0]) - (end_b[0] - start_b[0]) * (end_a[1] - start_a[1]);\n  if(denom == 0) return null; // parallel\n  var numer_a = (end_b[0] - start_b[0]) * (start_a[1] - start_b[1]) - (end_b[1] - start_b[1]) * (start_a[0] - start_b[0]);\n  var numer_b = (end_a[0] - start_a[0]) * (start_a[1] - start_b[1]) - (end_a[1] - start_a[1]) * (start_a[0] - start_b[0]);\n  if(numer_a == 0 && denom == 0 && numer_a == numer_b) return null; // coincident\n  var ua = numer_a / denom,\n      ub = numer_b / denom;\n  if(_vector.numberInRange(ua, 0.0, 1.0) && _vector.numberInRange(ub, 0.0, 1.0)){\n    return [\n      start_a[0] + ua * (end_a[0] - start_a[0]),\n      start_a[1] + ua * (end_a[1] - start_a[1]),\n      ua,\n      ub\n    ]; // return barycenric coordinates for alpha values in greiner-hormann\n  }\n  return null; // does not intersect\n\n};\n\n_polygon.TYPE_ISLAND = 0;\n_polygon.TYPE_HOLE = 1;\n\n_polygon.DIRECTION_INVALID = 0;\n_polygon.DIRECTION_CLOCKWISE = 1;\n_polygon.DIRECTION_COUNTERCLOCKWISE = -1;\n\n_polygon.prototype.assert.prototype = _polygon.prototype;\n_vector.prototype.assert.prototype = _vector.prototype;\n_EF.prototype.assert.prototype = _EF.prototype;\n\nvar DIRECTION_NONE = 0,DIRECTION_FORWARD = 1,DIRECTION_OPPOSITE = 2, DIRECTION_BOTH = 3;\nvar OPERATION_INTERSECTION = 0,OPERATION_UNION = 1,OPERATION_DIFFERENCE = 2,OPERATION_REV_DIFFERENCE = 3;\nvar ORIENTATION_SAME = 1,ORIENTATION_OPPOSITE = -1;\n\nvar T_VERTEX_OUTSIDE = 0,T_VERTEX_INSIDE = 1,T_VERTEX_BOUNDARY = 2;\n\n})();\nnsGmx.Translations.addText(\"rus\", {\n    FireVirtualLayer: {\n        \"LayerClusterBalloon\": \"<div style='margin-bottom: 5px;'><b style='color: red;'>Пожар</b></div>\" +\n            \"<b>Кол-во термоточек:</b> [count]<br/>\" +\n            \"<b>Время наблюдения:</b> [dateRange]<br/>\" +\n            \"<div>[SUMMARY]</div>\",\n        \"LayerClusterBalloonIndustrial\": \"<span style='margin-bottom: 5px;'><b style='color: red;'>Пожар</b></span> (вероятный техногенный источник <a target='blank' href='http://fires.kosmosnimki.ru/help.html#techno'>?</a>) <br/>\" +\n            \"<b>Кол-во термоточек:</b> [count]<br/>\" +\n            \"<b>Время наблюдения:</b> [dateRange]<br/>\" +\n            \"<div>[SUMMARY]</div>\",\n        \"LayerGeometryBalloon\": \"<div style='margin-bottom: 5px;'><b style='color: red;'>Контур пожара</b></div>\" +\n            \"<b>Кол-во термоточек:</b> [count]<br/>\" +\n            \"<b>Время наблюдения:</b> [dateRange]<br/>\" +\n            \"<div>[SUMMARY]</div>\",\n        \"zoomInMessage\": \"Приблизьте карту, чтобы увидеть контур\"\n    }\n});\n\nnsGmx.Translations.addText(\"eng\", {\n    FireVirtualLayer: {\n        \"LayerClusterBalloon\": \"<div style='margin-bottom: 5px;'><b style='color: red;'>Fire</b></div>\" +\n            \"<b>Number of hotspots:</b> [count]<br/>\" +\n            \"<b>Observation period:</b> [dateRange]<br/>\" +\n            \"<div>[SUMMARY]</div>\",\n        \"LayerClusterBalloonIndustrial\": \"<span style='margin-bottom: 5px;'><b style='color: red;'>Fire</b></span> (probable industrial hotspot <a target='_blank' href='http://fires.kosmosnimki.ru/help.html#techno'>?</a>)<br/>\" +\n            \"<b>Number of hotspots:</b> [count]<br/>\" +\n            \"<b>Observation period:</b> [dateRange]<br/>\" +\n            \"<div>[SUMMARY]</div>\",\n        \"LayerGeometryBalloon\": \"<div style='margin-bottom: 5px;'><b style='color: red;'>Fire outline</b></div>\" +\n            \"<b>Number of hotspots:</b> [count]<br/>\" +\n            \"<b>Observation period:</b> [dateRange]<br/>\" +\n            \"<div>[SUMMARY]</div>\",\n        \"zoomInMessage\": \"Zoom-in to see the outline\"\n    }\n});\n\n// для объединения квадратиков\n// Lookup table for pixel dimensions based on scan index of the pixel\nvar ModisPixelDimensions = [];\n\nfunction buildModisPixelDimensionsTable() {\n    // Don't rebuild the table if it was already built\n    if (ModisPixelDimensions.length > 0) {\n        return;\n    }\n\n    var h = 705.0; // Terra/Aqua orbit altitude [km]\n    var p = 1.0; // nadir pixel resolution [km]\n    var EARTH_RADIUS = 6371.0;\n    var SAMPLES = 1354;\n\n    var r = EARTH_RADIUS + h; /* [km] */\n    var s = p / h; /* [rad] */\n\n    for (var sample = 0; sample < 1354; sample++) {\n        var theta = sample * s + 0.5 * s - (0.5 * SAMPLES) * s;\n        var cos_theta = Math.cos(theta);\n\n        var temp = Math.pow((EARTH_RADIUS / r), 2.0) - Math.pow(Math.sin(theta), 2.0);\n        var sqrt_temp = Math.sqrt(temp);\n\n        var DS = EARTH_RADIUS * s * (cos_theta / sqrt_temp - 1.0) * 1000;\n        var DT = r * s * (cos_theta - sqrt_temp) * 1000;\n        ModisPixelDimensions[sample] = [DS, DT];\n    }\n}\n\n// тоже для квадратиков\nvar _hq = {\n    getDistant: function(cpt, bl) {\n        var Vy = bl[1][0] - bl[0][0];\n        var Vx = bl[0][1] - bl[1][1];\n        return (Vx * (cpt[0] - bl[0][0]) + Vy * (cpt[1] - bl[0][1]))\n    },\n    findMostDistantPointFromBaseLine: function(baseLine, points) {\n        var maxD = 0;\n        var maxPt = new Array();\n        var newPoints = new Array();\n        for (var idx in points) {\n            var pt = points[idx];\n            var d = this.getDistant(pt, baseLine);\n\n            if (d > 0) {\n                newPoints.push(pt);\n            } else {\n                continue;\n            }\n\n            if (d > maxD) {\n                maxD = d;\n                maxPt = pt;\n            }\n\n        }\n        return {\n            'maxPoint': maxPt,\n            'newPoints': newPoints\n        }\n    },\n\n    buildConvexHull: function(baseLine, points) {\n\n        var convexHullBaseLines = new Array();\n        var t = this.findMostDistantPointFromBaseLine(baseLine, points);\n        if (t.maxPoint.length) {\n            convexHullBaseLines = convexHullBaseLines.concat(this.buildConvexHull([baseLine[0], t.maxPoint], t.newPoints));\n            convexHullBaseLines = convexHullBaseLines.concat(this.buildConvexHull([t.maxPoint, baseLine[1]], t.newPoints));\n            return convexHullBaseLines;\n        } else {\n            return [baseLine];\n        }\n    },\n    getConvexHull: function(points) {\n\n        if (points.length == 1)\n            return [\n                [points[0], points[0]]\n            ];\n\n        //find first baseline\n        var maxX, minX;\n        var maxPt, minPt;\n        for (var idx in points) {\n            var pt = points[idx];\n            if (pt[0] > maxX || !maxX) {\n                maxPt = pt;\n                maxX = pt[0];\n            }\n            if (pt[0] < minX || !minX) {\n                minPt = pt;\n                minX = pt[0];\n            }\n        }\n        var ch = [].concat(this.buildConvexHull([minPt, maxPt], points),\n            this.buildConvexHull([maxPt, minPt], points))\n        return ch;\n    },\n    MultiPolygonUnion: function(multiPolygon) {\n        var matrixMultiPolygon = [],\n            unitedMultiPolygon = [],\n            nStartPolygons = 0,\n            currentPolygon;\n\n        do {\n            nStartPolygons = multiPolygon.length;\n            unitedMultiPolygon = [];\n\n            while (multiPolygon.length > 0) {\n                currentPolygon = multiPolygon.pop();\n                var iOther = 0;\n\n                // Check if it overlaps with any remaining polygons\n                while (iOther < multiPolygon.length) {\n\n                    var unionResults = currentPolygon.union(multiPolygon[iOther]);\n\n                    if (unionResults != null) {\n                        currentPolygon = unionResults;\n                        multiPolygon.splice(iOther, 1);\n                    } else {\n                        iOther++;\n                    }\n                }\n                unitedMultiPolygon.push(currentPolygon)\n            }\n            multiPolygon = unitedMultiPolygon;\n        } while (multiPolygon.length < nStartPolygons);\n\n        for (var i = 0; i < unitedMultiPolygon.length; i++) {\n            var poly = unitedMultiPolygon[i].to_point_array_2d();\n            poly.push(poly[0]);\n\n            matrixMultiPolygon.push([poly]);\n        }\n\n        return matrixMultiPolygon;\n    },\n    getPixelMultiPolygon: function(points) {\n        var results = [];\n\n        for (var i = 0; i < points.length; i++) {\n            var pt = points[i];\n            var dims = ModisPixelDimensions[pt[2]];\n\n            var merc = L.Projection.Mercator.project({\n                lat: pt[1],\n                lng: pt[0]\n            });\n            var X1 = merc.x;\n            var Y1 = merc.y;\n\n            var X2 = X1 + 1000;\n            var Y2 = Y1;\n\n            var newLatLng = L.Projection.Mercator.unproject({\n                x: X2,\n                y: Y2\n            });\n            var newLat = pt[1];\n            var newLon = newLatLng.lng;\n\n            var mdelta = L.gmxUtil.distVincenty(pt[0], pt[1], newLon, newLat);\n\n            var h_scale = dims[0] / mdelta;\n            var v_scale = dims[1] / mdelta;\n\n\n            var h_dx = 0.5 * (X2 - X1) * h_scale;\n            var h_dy = 0.5 * (Y2 - Y1) * h_scale;\n\n            var v_dx = 0.5 * (Y2 - Y1) * v_scale;\n            var v_dy = 0.5 * (X2 - X1) * v_scale;\n\n            var frontX = X1 + h_dx;\n            var frontY = Y1 + h_dy;\n\n            var backX = X1 - h_dx;\n            var backY = Y1 - h_dy;\n\n            var corner1x = frontX + v_dx;\n            var corner1y = frontY + v_dy;\n\n            var corner2x = frontX - v_dx;\n            var corner2y = frontY - v_dy;\n\n            var corner3x = backX - v_dx;\n            var corner3y = backY - v_dy;\n\n            var corner4x = backX + v_dx;\n            var corner4y = backY + v_dy;\n\n            results.push(SpatialQuery.$p([\n                [corner1x, corner1y],\n                [corner2x, corner2y],\n                [corner3x, corner3y],\n                [corner4x, corner4y]\n            ]));\n        }\n\n        return results;\n    }\n}\n\n\n\n// для вычисления расширенного ббокса\nvar mercBbox = function(latlngBbox) {\n    var mercMin = L.Projection.Mercator.project({\n        lat: latlngBbox.min.y,\n        lng: latlngBbox.min.x\n    });\n    var mercMax = L.Projection.Mercator.project({\n        lat: latlngBbox.max.y,\n        lng: latlngBbox.max.x\n    });\n    return L.gmxUtil.bounds([\n        [mercMin.x, mercMin.y],\n        [mercMax.x, mercMax.y]\n    ]);\n}\n\nvar fromMercBbox = function(bbox) {\n    var min = L.Projection.Mercator.unproject(bbox.min);\n    var max = L.Projection.Mercator.unproject(bbox.max);\n    return L.gmxUtil.bounds([\n        [min.lng, min.lat],\n        [max.lng, max.lat]\n    ]);\n}\n\nvar getExtendedBbox = function(mercOld, newBbox) {\n    var extendBbox = function(bbox) {\n        var sx = (bbox.max.x - bbox.min.x) * 0.15,\n            sy = (bbox.max.y - bbox.min.y) * 0.15;\n\n        return L.gmxUtil.bounds([\n            [bbox.min.x - sx, bbox.min.y - sy],\n            [bbox.max.x + sx, bbox.max.y + sy]\n        ]);\n    }\n\n    var mercNew = mercBbox(newBbox);\n\n    if (!mercOld) {\n        return fromMercBbox(extendBbox(mercNew));\n    }\n\n    var oldSquare = (mercOld.max.x - mercOld.min.x) * (mercOld.max.y - mercOld.min.y),\n        newSquare = (mercNew.max.x - mercNew.min.x) * (mercNew.max.y - mercNew.min.y);\n\n    if (!mercOld.contains([mercNew.min.x, mercNew.min.y]) || !mercOld.contains([mercNew.max.x, mercNew.max.y]) || 2 * newSquare <\n        oldSquare) {\n        return fromMercBbox(extendBbox(mercNew));\n    } else {\n        return null;\n    }\n}\n\n/*\n (c) 2014, Vladimir Agafonkin\n simpleheat, a tiny JavaScript library for drawing heatmaps with Canvas\n https://github.com/mourner/simpleheat\n*/\n\nfunction simpleheat(canvas) {\n    // jshint newcap: false, validthis: true\n    if (!(this instanceof simpleheat)) { return new simpleheat(canvas); }\n\n    this._canvas = canvas = typeof canvas === 'string' ? document.getElementById(canvas) : canvas;\n\n    this._ctx = canvas.getContext('2d');\n    this._width = canvas.width;\n    this._height = canvas.height;\n\n    this._max = 1;\n    this._data = [];\n}\n\nsimpleheat.prototype = {\n\n    defaultRadius: 25,\n\n    defaultGradient: {\n        0.4: 'blue',\n        0.6: 'cyan',\n        0.7: 'lime',\n        0.8: 'yellow',\n        1.0: 'red'\n    },\n\n    data: function (data) {\n        this._data = data;\n        return this;\n    },\n\n    max: function (max) {\n        this._max = max;\n        return this;\n    },\n\n    add: function (point) {\n        this._data.push(point);\n        return this;\n    },\n\n    clear: function () {\n        this._data = [];\n        return this;\n    },\n\n    radius: function(r, blur) {\n        this._radius = r;\n        this._blur = blur || 15;\n        this._r = r + this._blur;\n        return this;\n    },\n\n    minRadius: function(r) {\n        this._minRadius = r;\n        return this;\n    },\n\n    _circle: function (r, blur) {\n        // create a grayscale blurred circle image that we'll use for drawing points\n        var circle = document.createElement('canvas'),\n            ctx = circle.getContext('2d'),\n            r2 = r + blur;\n\n        circle.width = circle.height = r2 * 2;\n\n        ctx.shadowOffsetX = ctx.shadowOffsetY = 200;\n        ctx.shadowBlur = blur;\n        ctx.shadowColor = 'black';\n\n        ctx.beginPath();\n        ctx.arc(r2 - 200, r2 - 200, r, 0, Math.PI * 2, true);\n        ctx.closePath();\n        ctx.fill();\n\n        return circle;\n    },\n\n    gradient: function (grad) {\n        // create a 256x1 gradient that we'll use to turn a grayscale heatmap into a colored one\n        var canvas = document.createElement('canvas'),\n            ctx = canvas.getContext('2d'),\n            gradient = ctx.createLinearGradient(0, 0, 0, 256);\n\n        canvas.width = 1;\n        canvas.height = 256;\n\n        for (var i in grad) {\n            gradient.addColorStop(i, grad[i]);\n        }\n\n        ctx.fillStyle = gradient;\n        ctx.fillRect(0, 0, 1, 256);\n\n        this._grad = ctx.getImageData(0, 0, 1, 256).data;\n\n        return this;\n    },\n\n    draw: function (minOpacity) {\n        if (!this._circle) {\n            this.radius(this.defaultRadius);\n        }\n        if (!this._grad) {\n            this.gradient(this.defaultGradient);\n        }\n\n        var ctx = this._ctx;\n\n        ctx.clearRect(0, 0, this._width, this._height);\n\n        // draw a grayscale heatmap by putting a blurred circle at each data point\n        for (var i = 0, len = this._data.length, p; i < len; i++) {\n            p = this._data[i];\n\n            ctx.globalAlpha = Math.max(p[2] / this._max, minOpacity === undefined ? 0.05 : minOpacity);\n            var rr, bl;\n            if (this._minRadius) {\n                rr = Math.max(this._radius * (p[2] / this._max), this._minRadius);\n                bl = rr/this._radius * this._blur;\n            } else {\n                rr = this._radius;\n                bl = this._blur;\n            }\n            ctx.drawImage(this._circle(rr, bl), p[0] - (rr + bl), p[1] - (rr + bl));\n        }\n\n        // colorize the heatmap, using opacity value of each pixel to get the right color from our gradient\n        var colored = ctx.getImageData(0, 0, this._width, this._height);\n        this._colorize(colored.data, this._grad);\n        ctx.putImageData(colored, 0, 0);\n\n        return this;\n    },\n\n    _colorize: function (pixels, gradient) {\n        for (var i = 3, len = pixels.length, j; i < len; i += 4) {\n            j = pixels[i] * 4; // get gradient color from opacity value\n\n            if (j) {\n                pixels[i - 3] = gradient[j];\n                pixels[i - 2] = gradient[j + 1];\n                pixels[i - 1] = gradient[j + 2];\n            }\n        }\n    }\n};\n\n/*\n (c) 2014, Vladimir Agafonkin\n Leaflet.heat, a tiny and fast heatmap plugin for Leaflet.\n https://github.com/Leaflet/Leaflet.heat\n*/\n\n// в виртуальном слое пожаров используется изменённая версия HeatLayer\n// по-этому добавляем этот модуль в сборку\n\nvar HeatLayer = (L.Layer ? L.Layer : L.Class).extend({\n\n    // options: {\n    //     minOpacity: 0.05,\n    //     maxZoom: 18,\n    //     radius: 25,\n    //     blur: 15,\n    //     max: 1.0\n    // },\n\n    initialize: function(latlngs, options) {\n        this._latlngs = latlngs;\n        L.setOptions(this, options);\n    },\n\n    setLatLngs: function(latlngs) {\n        this._latlngs = latlngs;\n        return this.redraw();\n    },\n\n    addLatLng: function(latlng) {\n        this._latlngs.push(latlng);\n        return this.redraw();\n    },\n\n    setOptions: function(options) {\n        L.setOptions(this, options);\n        if (this._heat) {\n            this._updateOptions();\n        }\n        return this.redraw();\n    },\n\n    redraw: function() {\n        if (this._heat && !this._frame && !this._map._animating) {\n            this._frame = L.Util.requestAnimFrame(this._redraw, this);\n        }\n        return this;\n    },\n\n    onAdd: function(map) {\n        this._map = map;\n\n        if (!this._canvas) {\n            this._initCanvas();\n        }\n\n        map._panes.overlayPane.appendChild(this._canvas);\n\n        map.on('moveend', this._reset, this);\n\n        if (map.options.zoomAnimation && L.Browser.any3d) {\n            map.on('zoomanim', this._animateZoom, this);\n        }\n\n        this._reset();\n    },\n\n    onRemove: function(map) {\n        map.getPanes().overlayPane.removeChild(this._canvas);\n\n        map.off('moveend', this._reset, this);\n\n        if (map.options.zoomAnimation) {\n            map.off('zoomanim', this._animateZoom, this);\n        }\n    },\n\n    addTo: function(map) {\n        map.addLayer(this);\n        return this;\n    },\n\n    _initCanvas: function() {\n        var canvas = this._canvas = L.DomUtil.create('canvas', 'leaflet-heatmap-layer leaflet-layer');\n\n        var size = this._map.getSize();\n        canvas.width = size.x;\n        canvas.height = size.y;\n\n        var animated = this._map.options.zoomAnimation && L.Browser.any3d;\n        L.DomUtil.addClass(canvas, 'leaflet-zoom-' + (animated ? 'animated' : 'hide'));\n\n        this._heat = simpleheat(canvas);\n        this._updateOptions();\n    },\n\n    _updateOptions: function() {\n        this._heat.radius(this.options.radius || this._heat.defaultRadius, this.options.blur);\n\n        if (this.options.gradient) {\n            this._heat.gradient(this.options.gradient);\n        }\n        if (this.options.max) {\n            this._heat.max(this.options.max);\n        }\n        if (this.options.minRadius) {\n            this._heat.minRadius(this.options.minRadius);\n        }\n    },\n\n    _reset: function() {\n        var topLeft = this._map.containerPointToLayerPoint([0, 0]);\n        L.DomUtil.setPosition(this._canvas, topLeft);\n\n        var size = this._map.getSize();\n\n        if (this._heat._width !== size.x) {\n            this._canvas.width = this._heat._width = size.x;\n        }\n        if (this._heat._height !== size.y) {\n            this._canvas.height = this._heat._height = size.y;\n        }\n\n        this._redraw();\n    },\n\n    _redraw: function() {\n        var data = [],\n            r = this._heat._r,\n            size = this._map.getSize(),\n            bounds = new L.LatLngBounds(\n                this._map.containerPointToLatLng(L.point([-r, -r])),\n                this._map.containerPointToLatLng(size.add([r, r]))),\n\n            maxZoom = this.options.maxZoom === undefined ? this._map.getMaxZoom() : this.options.maxZoom,\n            v = 1 / Math.pow(2, Math.max(0, Math.min(maxZoom - this._map.getZoom(), 12))),\n            cellSize = r / 2,\n            grid = [],\n            panePos = this._map._getMapPanePos(),\n            offsetX = panePos.x % cellSize,\n            offsetY = panePos.y % cellSize,\n            i, len, p, cell, x, y, j, len2, k;\n\n        // console.time('process');\n        for (i = 0, len = this._latlngs.length; i < len; i++) {\n            if (bounds.contains(this._latlngs[i])) {\n                p = this._map.latLngToContainerPoint(this._latlngs[i]);\n                x = Math.floor((p.x - offsetX) / cellSize) + 2;\n                y = Math.floor((p.y - offsetY) / cellSize) + 2;\n\n                var alt =\n                    this._latlngs[i].alt !== undefined ? this._latlngs[i].alt :\n                    this._latlngs[i][2] !== undefined ? +this._latlngs[i][2] : 1;\n                k = alt * v;\n\n                grid[y] = grid[y] || [];\n                cell = grid[y][x];\n\n                if (!cell) {\n                    grid[y][x] = [p.x, p.y, k];\n\n                } else {\n                    cell[0] = (cell[0] * cell[2] + p.x * k) / (cell[2] + k); // x\n                    cell[1] = (cell[1] * cell[2] + p.y * k) / (cell[2] + k); // y\n                    cell[2] += k; // cumulated intensity value\n                }\n            }\n        }\n\n        for (i = 0, len = grid.length; i < len; i++) {\n            if (grid[i]) {\n                for (j = 0, len2 = grid[i].length; j < len2; j++) {\n                    cell = grid[i][j];\n                    if (cell) {\n                        data.push([\n                            Math.round(cell[0]),\n                            Math.round(cell[1]),\n                            Math.min(cell[2], 1)\n                        ]);\n                    }\n                }\n            }\n        }\n        // console.timeEnd('process');\n\n        // console.time('draw ' + data.length);\n        this._heat.data(data).draw(this.options.minOpacity);\n        // console.timeEnd('draw ' + data.length);\n\n        this._frame = null;\n    },\n\n    _animateZoom: function(e) {\n        var scale = this._map.getZoomScale(e.zoom),\n            offset = this._map._getCenterOffset(e.center)._multiplyBy(-scale).subtract(this._map._getMapPanePos());\n\n        if (L.DomUtil.setTransform) {\n            L.DomUtil.setTransform(this._canvas, offset, scale);\n\n        } else {\n            this._canvas.style[L.DomUtil.TRANSFORM] = L.DomUtil.getTranslateString(offset) + ' scale(' + scale + ')';\n        }\n    }\n});\n\nvar FireVirtualLayer = L.Class.extend({\n    options: {\n        minClustersZoom: 4,\n        minGeomZoom: 8,\n        minHotspotZoom: 11,\n        hostName: 'maps.kosmosnimki.ru'\n            // mapID\n            // hotspotLayerID\n            // dailyLayerID\n            // z_index\n    },\n\n    initialize: function(options) {\n        L.setOptions(this, options);\n\n        this._clustersLayer = L.gmx.createLayer({\n            properties: {\n                title: 'FireClusters',\n                attributes: ['scale', 'count', 'label', 'startDate', 'endDate', 'dateRange', 'isIndustrial'],\n                styles: [{\n                    Filter: '\"isIndustrial\"=0',\n                    Balloon: nsGmx.Translations.getText('FireVirtualLayer.LayerClusterBalloon'),\n                    MinZoom: this.options.minClustersZoom,\n                    MaxZoom: this.options.minGeomZoom - 1,\n                    RenderStyle: {\n                        fill: {\n                            radialGradient: {\n                                r1: 0,\n                                r2: '[scale]*20',\n                                addColorStop: [\n                                    [0, 0xffff00, 50],\n                                    [1, 0xff0000, 50]\n                                ]\n                            }\n                        },\n                        label: {\n                            size: 12,\n                            color: 0xffffff,\n                            field: 'label',\n                            align: 'center'\n                        }\n                    }\n                }, {\n                    Filter: '\"isIndustrial\"=1',\n                    Balloon: nsGmx.Translations.getText('FireVirtualLayer.LayerClusterBalloonIndustrial'),\n                    MinZoom: this.options.minClustersZoom,\n                    MaxZoom: this.options.minGeomZoom - 1,\n                    RenderStyle: {\n                        fill: {\n                            radialGradient: {\n                                r1: 0,\n                                r2: '[scale]*20',\n                                addColorStop: [\n                                    [0, 0xffffff, 80],\n                                    [1, 0xffaa00, 80]\n                                ]\n                            }\n                        }\n                    }\n                }]\n            }\n        });\n\n        this._clustersGeomLayer = L.gmx.createLayer({\n            properties: {\n                type: 'Vector',\n                title: 'FirePolygons',\n                attributes: ['scale', 'count', 'label', 'startDate', 'endDate', 'dateRange', 'isIndustrial'],\n                styles: [{\n                    Balloon: nsGmx.Translations.getText('FireVirtualLayer.LayerGeometryBalloon'),\n                    MinZoom: this.options.minGeomZoom,\n                    MaxZoom: 21,\n                    RenderStyle: {\n                        outline: {\n                            color: 0xff0000,\n                            thickness: 2\n                        },\n                        fill: {\n                            color: 0xff0000,\n                            opacity: 15\n                        }\n                    },\n                    HoverStyle: {\n                        outline: {\n                            color: 0xff0000,\n                            thickness: 3\n                        },\n                        fill: {\n                            color: 0xff0000,\n                            opacity: 45\n                        }\n                    }\n                }]\n            }\n        });\n\n        this._heatmapLayer = new HeatLayer([], {\n            \"gradient\": {\n                \"1.00\": \"#FFFFFF\",\n                \"0.90\": \"#FFAA00\",\n                \"0.85\": \"#FF8800\",\n                \"0.75\": \"#E65C00\",\n                \"0.55\": \"#DB1D00\"\n            },\n            \"blur\": 30,\n            \"radius\": 17,\n            \"minRadius\": 7,\n            \"minOpacity\": 0.65\n        });\n\n        if (this.options['z_index']) {\n            this._clustersLayer.setZIndex(this.options['z_index']);\n            this._clustersGeomLayer.setZIndex(this.options['z_index']);\n        }\n\n        var _this = this;\n        this._clustersLayer.on('popupopen', function(event) {\n            var popup = event.popup,\n                html = popup.getContent(),\n                zoomLink = $('<div style=\"margin-top: 5px;\"><a href=\"javascript:void(0)\"><i>' + nsGmx.Translations.getText(\n                    'FireVirtualLayer.zoomInMessage') + '</i></a></div>').click(function() {\n                    _this._map.closePopup(event.popup);\n                    _this._map.setView(event.gmx.latlng, _this.options.minGeomZoom + 3);\n                });\n\n            var div = $('<div/>').html(html).append(zoomLink);\n            event.popup.setContent(div[0]);\n        })\n    },\n\n    onAdd: function(map) {\n        buildModisPixelDimensionsTable();\n        this._map = map;\n        this._layerIsVisible = true;\n        this._lazyLoadDataLayers().then(function() {\n            if (!this._map || !this._layerIsVisible) {\n                return;\n            }\n\n            map.on('zoomend', this._updateLayersVisibility, this);\n            map.on('moveend', this._updateBbox, this);\n\n            this._updateLayersVisibility();\n            this._updateBbox();\n\n            map.addLayer(this._clustersLayer);\n            map.addLayer(this._clustersGeomLayer);\n            map.addLayer(this._hotspotLayer);\n        }.bind(this));\n    },\n\n    onRemove: function(map) {\n        delete this._map;\n        this._layerIsVisible = false;\n        map.off('moveend', this._updateBbox, this);\n        map.off('zoomend', this._updateLayersVisibility, this);\n        this._updateLayersVisibility();\n        this._lazyLoadDataLayers().then(function() {\n            if (this._layerIsVisible) {\n                return;\n            }\n\n            map.removeLayer(this._clustersGeomLayer);\n            map.removeLayer(this._clustersLayer);\n            map.removeLayer(this._hotspotLayer);\n            map.removeLayer(this._heatmapLayer);\n        }.bind(this))\n    },\n\n    setDateInterval: function(dateBegin, dateEnd) {\n        this._dateBegin = dateBegin;\n        this._dateEnd = dateEnd;\n        this._rawClusterLayer && this._rawClusterLayer.setDateInterval(dateBegin, dateEnd);\n        this._hotspotLayer && this._hotspotLayer.setDateInterval(dateBegin, dateEnd);\n\n        this._observerClusters && this._observerClusters.setDateInterval(dateBegin, dateEnd);\n        this._observerHotspots && this._observerHotspots.setDateInterval(dateBegin, dateEnd);\n        this._observerHeatmap && this._observerHeatmap.setDateInterval(dateBegin, dateEnd);\n    },\n\n    _updateBbox: function() {\n        var observersBbox = this._observerHotspots.bbox,\n            screenBounds = this._map.getBounds(),\n            p1 = screenBounds.getNorthWest(),\n            p2 = screenBounds.getSouthEast(),\n            newBbox = L.gmxUtil.bounds([\n                [p1.lng, p1.lat],\n                [p2.lng, p2.lat]\n            ]),\n            extendedBbox = getExtendedBbox(observersBbox, newBbox);\n\n        if (extendedBbox) {\n            this._observerHotspots.setBounds(extendedBbox);\n            this._observerClusters.setBounds(extendedBbox);\n            this._observerHeatmap.setBounds(extendedBbox);\n        }\n    },\n\n    //load layers add add observers\n    _lazyLoadDataLayers: function() {\n        if (this._loadLayersPromise) {\n            return this._loadLayersPromise;\n        }\n\n        var heatmapLayerID = this.options.heatmapLayerID || this.options.hotspotLayerID;\n\n        this._loadLayersPromise = L.gmx.loadLayers([{\n            mapID: this.options.mapID,\n            layerID: this.options.hotspotLayerID\n        }, {\n            mapID: this.options.mapID,\n            layerID: this.options.dailyLayerID\n        }], {\n            hostName: this.options.hostName\n        }).then(function(rawHotspotLayer, rawClustersLayer) {\n\n            if (this.options.minHotspotZoom) {\n                var minZoom = this.options.minHotspotZoom;\n                rawHotspotLayer.setStyles(rawHotspotLayer.getStyles().map(function(style) {\n                    style.MinZoom = minZoom;\n                    return style;\n                }));\n            }\n\n            var rawHeatmapLayer;\n            if (heatmapLayerID === rawHotspotLayer.options.layerID) {\n                rawHeatmapLayer = rawHotspotLayer;\n            }\n            if (heatmapLayerID === rawClustersLayer.options.layerID) {\n                rawHeatmapLayer = rawClustersLayer;\n            }\n\n            this._hotspotLayer = rawHotspotLayer;\n\n            if (this._dateBegin && this._dateEnd) {\n                this._hotspotLayer.setDateInterval(this._dateBegin, this._dateEnd);\n            }\n\n            this._rawClusterLayer = rawClustersLayer;\n\n            if (this.options['z_index']) {\n                this._hotspotLayer.setZIndex(this.options['z_index']);\n            }\n\n            this._observerHeatmap = rawHeatmapLayer.addObserver({\n                type: 'update',\n                callback: this._createHeatmapObserverCallback(rawHeatmapLayer, this._heatmapLayer),\n                active: !!this._map,\n                dateInterval: [this._dateBegin, this._dateEnd]\n            });\n\n            this._observerClusters = rawClustersLayer.addObserver({\n                type: 'update',\n                callback: this._updateClustersByObject(this._clustersLayer, false, 'ParentClusterId',\n                    'HotSpotCount', rawClustersLayer),\n                active: !!this._map,\n                dateInterval: [this._dateBegin, this._dateEnd]\n            });\n\n            this._observerHotspots = rawHotspotLayer.addObserver({\n                type: 'update',\n                callback: this._updateClustersByObject(this._clustersGeomLayer, true, 'ClusterID', null,\n                    rawHotspotLayer),\n                active: !!this._map,\n                dateInterval: [this._dateBegin, this._dateEnd]\n            });\n        }.bind(this));\n\n        return this._loadLayersPromise;\n    },\n\n    _createHeatmapObserverCallback: function(srcLayer, heatLayer) {\n        var pointsBuffer = [];\n\n        var weightFieldsHash = {\n            'F2840D287CD943C4B1122882C5B92565': 4,\n            'C13B4D9706F7491EBC6DC70DFFA988C0': 4,\n            'E58063D97D534BB4BBDFF07FE5CB17F2': 1,\n            '3E88643A8AC94AFAB4FD44941220B1CE': 1\n        }\n\n        function addData(data) {\n            pointsBuffer = pointsBuffer.concat(data);\n            return pointsBuffer;\n        }\n\n        function removeData(data) {\n            pointsBuffer = pointsBuffer.filter(function(it) {\n                return !data.find(function (d) {\n                    return d.id === it.id\n                })\n            })\n            return pointsBuffer\n        }\n\n        function parser(data) {\n            return data.map(function(d) {\n                var props = d.properties;\n\n                var latlng = L.Projection.Mercator.unproject({\n                    y: props[props.length - 1].coordinates[1],\n                    x: props[props.length - 1].coordinates[0]\n                })\n\n                var r = [latlng.lat, latlng.lng];\n                var fi = weightFieldsHash[srcLayer.options.layerID];\n                fi && props[fi] && r.push(factor(props[fi]));\n\n                return r;\n            })\n        }\n\n        function factor(w) {\n            return 3800 * (Math.pow(Math.log(w + 1), 1.3) / 3.5);\n        }\n\n        return function(data) {\n            data.added && addData(data.added);\n            data.removed && removeData(data.removed);\n            heatLayer.setLatLngs(parser(pointsBuffer));\n        }\n    },\n\n    _updateClustersByObject: function(layer, estimeteGeometry, clusterAttr, countAttr, fromLayer) {\n        var indexes = fromLayer._gmx.tileAttributeIndexes,\n            dateAttr = fromLayer.getGmxProperties().TemporalColumnName,\n            idAttr = fromLayer.getGmxProperties().identityField;\n\n        var parseItem = function(item) {\n            var props = item.properties;\n            return {\n                properties: L.gmxUtil.getPropertiesHash(props, indexes),\n                geometry: props[props.length - 1]\n            };\n        };\n\n        var clusters = {};\n\n        return function(data) {\n            var objects = [];\n            var clustersToRepaint = {};\n\n            (data.removed || []).map(function(it) {\n                objects.push({\n                    onExtent: false,\n                    item: parseItem(it)\n                });\n            });\n            (data.added || []).map(function(it) {\n                objects.push({\n                    onExtent: true,\n                    item: parseItem(it)\n                });\n            });\n\n            for (var k = 0; k < objects.length; k++) {\n                var props = objects[k].item.properties;\n                var mult = objects[k].onExtent ? 1 : -1;\n                var count = (countAttr ? props[countAttr] : 1) * mult;\n\n                if (!props[clusterAttr])\n                    continue;\n\n                var clusterId = '_' + props[clusterAttr];\n                var hotspotId = '_' + props[idAttr];\n\n                if (!clusters[clusterId]) {\n                    clusters[clusterId] = {\n                        spots: {},\n                        lat: 0,\n                        lng: 0,\n                        count: 0,\n                        startDate: Number.POSITIVE_INFINITY,\n                        endDate: Number.NEGATIVE_INFINITY,\n                        isIndustrial: false\n                    };\n                }\n                var cluster = clusters[clusterId];\n\n                //два раза одну и ту же точку не добавляем\n                if (hotspotId in cluster.spots && objects[k].onExtent)\n                    continue;\n\n                var coords = objects[k].item.geometry.coordinates,\n                    latlng = L.Projection.Mercator.unproject({\n                        y: coords[1],\n                        x: coords[0]\n                    });\n\n                if (objects[k].onExtent)\n                    cluster.spots[hotspotId] = [latlng.lng, latlng.lat, 250]; //TODO: выбрать правильный номер sample\n                else\n                    delete cluster.spots[hotspotId];\n\n                var hotspotDate = props[dateAttr];\n\n                cluster.lat += count * coords[1];\n                cluster.lng += count * coords[0];\n                cluster.count += count;\n                cluster.startDate = Math.min(cluster.startDate, hotspotDate);\n                cluster.endDate = Math.max(cluster.endDate, hotspotDate);\n                cluster.isIndustrial = cluster.isIndustrial || (Number(props.FireType) & 1);\n\n                clustersToRepaint[clusterId] = true;\n            }\n\n            var clustersToAdd = [],\n                itemIDsToRemove = [];\n\n            for (var k in clustersToRepaint) {\n                var cluster = clusters[k],\n                    count = cluster.count;\n                if (count) {\n                    var strStartDate = dateToString(cluster.startDate);\n                    var strEndDate = dateToString(cluster.endDate);\n\n                    var newItem = [\n                        k,\n                        String(Math.pow(Math.log(count + 1), 1.3) / 3.5),\n                        count,\n                        count >= 10 ? count : null,\n                        cluster.startDate,\n                        cluster.endDate,\n                        cluster.startDate === cluster.endDate ? strEndDate : strStartDate + '-' + strEndDate,\n                        Number(cluster.isIndustrial)\n                    ];\n\n                    if (estimeteGeometry) {\n                        var points = [];\n                        for (var p in clusters[k].spots)\n                            points.push(clusters[k].spots[p]);\n\n                        var multiPolygon = _hq.getPixelMultiPolygon(points);\n                        var tmpPolygon = _hq.MultiPolygonUnion(multiPolygon);\n\n                        newItem.push({\n                            type: 'MULTIPOLYGON',\n                            coordinates: tmpPolygon\n                        });\n                    } else {\n                        newItem.push({\n                            type: 'POINT',\n                            coordinates: [clusters[k].lng / count, clusters[k].lat / count]\n                        });\n                    }\n\n                    clustersToAdd.push(newItem);\n                } else {\n                    itemIDsToRemove.push(k);\n                    delete clusters[k];\n\n                }\n            }\n\n            layer.addData(clustersToAdd);\n            layer.removeData(itemIDsToRemove);\n        }\n\n        // для балунов\n        function dateToString(timestamp) {\n            var date = new Date(timestamp * 1000);\n\n            var lz = function(n) {\n                return n > 9 ? n : '0' + n;\n            };\n\n            return lz(date.getUTCDate()) + '.' + lz(date.getUTCMonth() + 1) + '.' + date.getUTCFullYear();\n        }\n\n    },\n\n    _updateLayersVisibility: function() {\n        var map = this._map;\n        var isVisible = !!map,\n            zoom = this._map && this._map.getZoom();\n\n        this._observerHotspots && this._observerHotspots.toggleActive(isVisible && zoom >= this.options.minGeomZoom);\n        this._observerClusters && this._observerClusters.toggleActive(isVisible && (zoom >= this.options.minClustersZoom && zoom < this.options\n            .minGeomZoom));\n        this._observerHeatmap && this._observerHeatmap.toggleActive(isVisible && zoom < this.options.minClustersZoom);\n\n        // this._heatmapLayer && this._heatmapLayer.setVisibility(isVisible && zoom < this.options.minClustersZoom);\n        map && ((isVisible && zoom < this.options.minClustersZoom) ? map.addLayer(this._heatmapLayer) : map.removeLayer(this._heatmapLayer));\n    }\n});\n\nvar FireVirtualFactory = function() {};\nFireVirtualFactory.prototype.initFromDescription = function(layerDescription) {\n    var props = layerDescription.properties,\n        meta = props.MetaProperties;\n\n    var options = {\n        mapID: meta.mapID.Value,\n        hotspotLayerID: meta.hotspotLayerID.Value,\n        dailyLayerID: meta.dailyLayerID.Value,\n        heatmapLayerID: meta.heatmapLayerID &&  meta.heatmapLayerID.Value,\n        z_index: meta.z_index && meta.z_index.Value\n    }\n\n    if ('minGeomZoom' in meta) {\n        options.minGeomZoom = Number(meta.minGeomZoom.Value);\n    }\n\n    if ('minHotspotZoom' in meta) {\n        options.minHotspotZoom = Number(meta.minHotspotZoom.Value);\n    }\n\n    if ('minClustersZoom' in meta) {\n        options.minClustersZoom = Number(meta.minClustersZoom.Value);\n    }\n\n    var layer = new FireVirtualLayer(options);\n\n    layer.getGmxProperties = function() {\n        return props;\n    }\n\n    return layer;\n}\n\nL.gmx.addLayerClass('Fire', FireVirtualFactory);\n}());\n\n\n\n/** WEBPACK FOOTER **\n ** ./external/FireVirtualLayer/dist/fireVirtualLayer.js\n **/","/** Leaflet layers\n*/\n(function (){\n    \nvar GFW_ATTRIBUTION = '<a href=\"http://glad.umd.edu/\"> Hansen|UMD|Google|USGS|NASA </a>';\n\nL.GFWLayer = L.TileLayer.Canvas.extend({\n    options: {\n        async: true,\n        attribution: GFW_ATTRIBUTION\n    },\n    _yearBegin: 2001,\n    _yearEnd: 2015,\n    _drawLayer: function(img, ctx, z) {\n        var imgData = ctx.getImageData(0, 0, 256, 256),\n            data = imgData.data,\n            exp = z < 11 ? 0.3 + ((z - 3) / 20) : 1;\n            \n        for (var i = 0; i < 256; ++i) {\n            for (var j = 0; j < 256; ++j) {\n                var pixelPos = (j * 256 + i) * 4,\n                    yearLoss = 2000 + data[pixelPos + 2],\n                    intensity = data[pixelPos],\n                    scale = Math.pow(intensity/256, exp) * 256;\n\n                if (yearLoss >= this._yearBegin && yearLoss < this._yearEnd) {\n                    data[pixelPos] = 220;\n                    data[pixelPos + 1] = (72 - z) + 102 - (3 * scale / z);\n                    data[pixelPos + 2] = (33 - z) + 153 - ((intensity) / z);\n                    data[pixelPos + 3] = z < 13 ? scale : intensity;\n                } else {\n                    data[pixelPos + 3] = 0;\n                }\n            }\n        }\n        \n        ctx.putImageData(imgData, 0, 0);\n    },\n    drawTile: function(canvas, tilePoint, zoom) {\n        var img = new Image();\n        img.crossOrigin = \"Anonymous\";\n        img.onload = function() {\n            var ctx = canvas.getContext('2d');\n            ctx.drawImage(img, 0, 0, 256, 256);\n            this._drawLayer(img, ctx, zoom);\n            this.tileDrawn(canvas);\n        }.bind(this);\n        \n        img.src = 'http://storage.googleapis.com/earthenginepartners-hansen/tiles/gfw2015/loss_tree_year_25/' + zoom + '/' + tilePoint.x + '/' + tilePoint.y + '.png';\n    },\n    setYearInterval: function(yearBegin, yearEnd) {\n        this._yearBegin = yearBegin;\n        this._yearEnd = yearEnd;\n        this.redraw();\n    }\n});\n\n//Helper layer with integrated slider control\nL.GFWLayerWithSlider = L.Class.extend({\n    initialize: function() {\n        var layer = this._layer = new L.GFWLayer();\n        this._slider = new L.GFWSlider({position: 'bottomright'});\n        \n        this._slider.on('yearschange', function(data) {\n            layer.setYearInterval(data.yearBegin, data.yearEnd);\n        })\n    },\n    \n    onAdd: function(map) {\n        map.addLayer(this._layer);\n        map.addControl(this._slider);\n    },\n    \n    onRemove: function(map) {\n        map.removeLayer(this._layer);\n        map.removeControl(this._slider);\n    },\n    \n    setZIndex: function() {\n        return this._layer.setZIndex.apply(this._layer, arguments);\n    },\n    \n    getSlider: function() {\n        return this._slider;\n    },\n    \n    options: {\n        attribution: GFW_ATTRIBUTION\n    }\n})\n\n})();\n/** Leaflet control for years interval selection\n * Requires jQuery and Handlebars\n*/\nL.GFWSlider = L.Control.extend({\n    includes: L.Mixin.Events,\n    _yearBegin: 2001,\n    _yearEnd: 2015,\n    _setYears: function(yearBegin, yearEnd) {\n        this._yearBegin = yearBegin;\n        this._yearEnd = yearEnd;\n        this.fire('yearschange', {yearBegin: this._yearBegin, yearEnd: this._yearEnd});\n    },\n    onAdd: function(map) {\n        var template = Handlebars.compile(\n            '<div class = \"gfw-slider\">' + \n                '<div class = \"gfw-slider-container\"></div>' +\n                '<div class = \"gfw-slider-labels\">' +\n                    '{{#labels}}' +\n                        '<div class = \"gfw-label-item\">{{.}}</div>' +\n                    '{{/labels}}' +\n                '</div>' +\n            '</div>'\n        );\n        \n        var labels = [];\n        for (var year = 2001; year <= 2014; year++) {\n            labels.push(year);\n        }\n        \n        var ui = this._ui = $(template({\n            labels: labels\n        }));\n        \n        ui.find('.gfw-slider-container').slider({\n            min: 2001,\n            max: 2015,\n            values: [this._yearBegin, this._yearEnd],\n            range: true,\n            change: function(event, ui) {\n                this._setYears(ui.values[0], ui.values[1]);\n            }.bind(this)\n        });\n        \n        ui.on('mousedown', function(event) {\n            event.stopPropagation();\n        });\n        \n        return ui[0];\n    },\n    \n    onRemove: function() {\n    },\n    \n    saveState: function() {\n        return {\n            version: '1.0.0',\n            yearBegin: this._yearBegin,\n            yearEnd: this._yearEnd\n        }\n    },\n    \n    loadState: function(data) {\n        if (this._ui) {\n            this._ui.find('.gfw-slider-container').slider('option', 'values', [data.yearBegin, data.yearEnd]);\n        } else {\n            this._setYears(data.yearBegin, data.yearEnd);\n        }\n    }\n});\n/** GeoMixer virtual layer\n*/\n(function (){\n\nvar defineClass = function() {\n    var GeoMixerGFWLayer = L.GFWLayerWithSlider.extend({\n        initFromDescription: function(layerDescription) {\n            this._gmxProperties = layerDescription.properties;\n            return this;\n        },\n        getGmxProperties: function() {\n            return this._gmxProperties;\n        }\n    });\n    L.gmx.addLayerClass('GFW', GeoMixerGFWLayer);\n    return GeoMixerGFWLayer;\n}\n\n\nif (window.gmxCore) {\n    gmxCore.addModule('GFWVirtualLayer', function() {\n        return {\n            layerClass: defineClass()\n        }\n    }, {\n        init: function(module, path) {\n            if (!L.GFWLayerWithSlider) {\n                gmxCore.loadCSS(path + 'L.GFWSlider.css');\n                return $.when(\n                    gmxCore.loadScript(path + 'L.GFWLayer.js'),\n                    gmxCore.loadScript(path + 'L.GFWSlider.js')\n                );\n            }\n        }\n        \n    });\n} else {\n    defineClass();\n}\n \n})();\n/** GeoMixer plugin\n*/\n(function (){\nif (!window.gmxCore) {\n    return\n}\n\nvar publicInterface = {\n    pluginName: 'GFW Plugin'\n}\n\ngmxCore.addModule('GFWPlugin', publicInterface, {\n    init: function(module, path) {\n        return gmxCore.loadModule('GFWVirtualLayer', path + 'GmxGFWLayer.js');\n    }\n});\n\n})();\n\n\n\n/** WEBPACK FOOTER **\n ** ./external/GMXPluginGFW/dist/gmxPluginGfw.js\n **/","// removed by extract-text-webpack-plugin\n\n\n/*****************\n ** WEBPACK FOOTER\n ** ./external/GMXPluginGFW/dist/gmxPluginGfw.css\n ** module id = 4\n ** module chunks = 0\n **/"],"sourceRoot":""}